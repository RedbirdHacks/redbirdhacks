/*!CK:3809569731!*//*1422248679,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yKpyi"]); }

__d("GroupSellUserActionEvents",[],function(a,b,c,d,e,f){e.exports={MARK_AS_SOLD:"mark_as_sold",MARK_AS_AVAILABLE:"mark_as_available",GROUP_POST:"group_post",LAUNCH_EDIT:"launch_edit",GROUP_POST_EDIT:"group_post_edit",ADMIN_OPT_IN:"admin_opt_in",ADMIN_OPT_OUT:"admin_opt_out",ADMIN_NOT_FOR_SALE:"admin_not_for_sale",ADMIN_DO_NOT_WANT:"admin_do_not_want",OPT_IN_MEGAPHONE_SEEN:"opt_in_megaphone_seen",OPT_IN_NOTIFICATION_SENT:"opt_in_notification_sent",GROUP_NON_FOR_SALE_POST:"group_non_for_sale_post",COMPOSER_TOOLTIP_NUX_SEEN:"composer_tooltip_nux_seen",COMPOSER_LOAD:"composer_load",LAUNCH_SELL_COMPOSER:"launch_sell_composer",LAUNCH_NORMAL_COMPOSER:"launch_normal_composer",COMPOSER_FILL_TITLE:"composer_fill_title",COMPOSER_FILL_PRICE:"composer_fill_price",COMPOSER_FILL_DESCRIPTION:"composer_fill_description",COMPOSER_FILL_PICKUP_NOTE:"composer_fill_pickup_note",COMPOSER_DELETE_PHOTO:"composer_delete_photo",COMPOSER_SUBMIT:"composer_submit"};},null);
__d("ComposerXHiddenInputClear",[],function(a,b,c,d,e,f){function g(h){h.element.value='';}e.exports=g;},null);
__d("ComposerXSessionInputClear",[],function(a,b,c,d,e,f){function g(h){h.element.value=(new Date()).valueOf().toString().substr(0,10);}e.exports=g;},null);
__d("ComposerTagSuggestionsWaterfall",["Banzai","copyProperties"],function(a,b,c,d,e,f,g,h){var i='composer_tag_suggestions';function j(k){"use strict";this._waterfallID=k;}j.prototype.setWaterfallID=function(k){"use strict";this._waterfallID=k;};j.prototype._logStep=function(k,l){"use strict";l=h({},l||{},{waterfall_id:this._waterfallID,step:k});g.post(i,l);return this;};j.prototype.logBegin=function(){"use strict";return this._logStep('begin');};j.prototype.logAddPhoto=function(k){"use strict";return this._logStep('add_photo',{photo:k});};j.prototype.logAddPhotos=function(k){"use strict";k.forEach(this.logAddPhoto.bind(this));};j.prototype.logRemovePhoto=function(k,l,m){"use strict";return this._logStep('remove_photo',{photo:k,tokens:l,suggestions:m});};j.prototype.logAddToken=function(k,l){"use strict";return this._logStep('add_token',{user:k,replaced_with_tag:l});};j.prototype.logRemoveToken=function(k,l){"use strict";return this._logStep('remove_token',{user:k,suggestions:l});};j.prototype.logAddSuggestion=function(k,l,m,n){"use strict";return this._logStep('add_suggestion',{photo:k,facebox:l,user:m,certainty:n});};j.prototype.logRemoveSuggestion=function(k,l,m,n){"use strict";return this._logStep('remove_suggestion',{photo:k,facebox:l,user:m,certainty:n});};j.prototype.logAddManualTag=function(k,l,m){"use strict";return this._logStep('add_tag',{photo:k,facebox:l,user:m});};j.prototype.logRemoveManualTag=function(k,l,m){"use strict";return this._logStep('remove_tag',{photo:k,facebox:l,user:m});};j.prototype.logStartPoll=function(k){"use strict";return this._logStep('start_poll',{photos:k});};j.prototype.logStopPoll=function(k,l){"use strict";return this._logStep('stop_poll',{time_spent:k,unresolved_photos:l});};j.prototype.logSubmit=function(k,l,m,n,o,p){"use strict";return this._logStep('submit',{photos:k,tokens:l,manual_tokens:m,suggestions:n,manual_tags:o,time_spent:p});};j.prototype.logFailure=function(k,l){"use strict";return this._logStep('fail',{photo:k,user:l});};e.exports=j;},null);
__d("InstanceRegistry",[],function(a,b,c,d,e,f){function g(){"use strict";this.instances={};this.waits=[];}g.prototype.set=function(h,i){"use strict";this.instances[h]=i;this.waits=this.waits.filter(function(j){if(this._isWaitResolved(j.names)){j.callback.apply(this,this._mapNamesToInstances(j.names));return false;}return true;}.bind(this));};g.prototype.get=function(h){"use strict";return this.instances[h];};g.prototype.remove=function(h){"use strict";delete this.instances[h];};g.prototype.waitFor=function(h,i){"use strict";if(this._isWaitResolved(h))return i.apply(this,this._mapNamesToInstances(h));this.waits.push({names:h,callback:i});};g.prototype.waitForAndRemove=function(h,i){"use strict";this.waitFor(h,function(){i.apply(this,arguments);h.forEach(this.remove.bind(this));}.bind(this));};g.prototype._isWaitResolved=function(h){"use strict";return h.every(this.instances.hasOwnProperty.bind(this.instances));};g.prototype._mapNamesToInstances=function(h){"use strict";return h.map(function(i){return this.instances[i];}.bind(this));};e.exports=new g();},null);
__d("PhotosTaggingFlyoutLoader",["ArbiterMixin","AsyncRequest","InstanceRegistry","URI","arrayContains","mixin","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=l(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r){"use strict";this._flyouts={};this._loading=[];this._callbacks={};this._targetID=r;}q.prototype.get=function(r,s){"use strict";if(this._isLoaded(r))return s(this._flyouts[r]);this._callbacks[r]=this._callbacks[r]||[];if(!this._isLoading(r))this._load(r);this._callbacks[r].push(s);};q.prototype.whenLoaded=function(r,s){"use strict";if(this._isLoaded(r))return s(this._flyouts[r]);this._callbacks[r]=this._callbacks[r]||[];this._callbacks[r].push(s);};q.prototype._load=function(r){"use strict";if(this._isLoading(r))return;this._loading.push(r);new h().setURI(j('/ajax/photos/tagging-flyout/').addQueryData({photo:r,target:this._targetID,recognitionFeature:'composer_facerec'})).setHandler(function(){i.waitForAndRemove(['PhotosTaggingFlyout_'+r],function(s){if(!this._isLoading(r))return;this.inform('loaded',s);this._flyouts[r]=s;this._callbacks[r].forEach(function(t){t(s);});delete this._callbacks[r];}.bind(this));}.bind(this)).setFinallyHandler(function(){m(this._loading,r);}.bind(this)).send();};q.prototype._isLoading=function(r){"use strict";return k(this._loading,r);};q.prototype._isLoaded=function(r){"use strict";return !!this._flyouts[r];};q.prototype.remove=function(r){"use strict";if(this._isLoaded(r))this._flyouts[r].cleanup();delete this._flyouts[r];delete this._callbacks[r];m(this._loading,r);};q.prototype.cleanup=function(){"use strict";Object.keys(this._flyouts).forEach(this.remove.bind(this));Object.keys(this._callbacks).forEach(this.remove.bind(this));};e.exports=q;},null);
__d("FaceRecognitionController",["ArbiterMixin","BanzaiODS","Poller","copyProperties","mixin","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=k(g);for(var n in m)if(m.hasOwnProperty(n))p[n]=m[n];var o=m===null?null:m.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=m;function p(q){"use strict";this._config=j({uri:'/photos/tagging/recognition/',interval:2000,maxRequests:4,targetIsPage:false,targetID:null},q);this._cleanup();this._poller=new i({dontStart:true,maxRequests:this._config.maxRequests,interval:this._config.interval,setupRequest:function(r){r.setURI(this._config.uri).setData({recognition_project:'composer_facerec',photos:this._pendingPhotos,waterfallID:this._config.waterfallID,target:this._config.targetID,is_page:this._config.targetIsPage,include_unrecognized_faceboxes:!!this._config.include_unrecognized_faceboxes,include_face_crop_src:!!this._config.include_face_crop_src,include_recognized_user_profile_picture:!!this._config.include_recognized_user_profile_picture,include_low_confidence_recognitions:!!this._config.include_low_confidence_recognitions}).setHandler(this._handleResponse.bind(this));}.bind(this)});this._poller.subscribe('done',function(){var r=this._pendingPhotos;this._cleanup();this.inform('done',{unresolved:r});}.bind(this));}p.prototype.setWaterfallID=function(q){"use strict";this._config.waterfallID=q;};p.prototype.start=function(q){"use strict";Array.prototype.push.apply(this._pendingPhotos,q);this._poller.reset();this._resetSafeguardTimeout();};p.prototype.stop=function(){"use strict";this._poller.stop();this._cleanup();};p.prototype._cleanup=function(){"use strict";window.clearTimeout(this._safeguardTimeout);this._safeguardTimeout=null;this._pendingPhotos=[];};p.prototype._resetSafeguardTimeout=function(){"use strict";window.clearTimeout(this._safeguardTimeout);this._safeguardTimeout=window.setTimeout(function(){h.bumpEntityKey('composer_facerec','safeguard');var q=this._pendingPhotos;this._poller.stop();this._cleanup();this.inform('done',{unresolved:q});}.bind(this),(this._config.maxRequests+2)*this._config.interval);};p.prototype._handleResponse=function(q){"use strict";var r=q.getPayload();r.forEach(function(s){var t=0;l(this._pendingPhotos,s.fbid);s.faceboxes.forEach(function(u){t+=u.recognitions.length;u.recognitions.forEach(function(v){this.inform('recognition',{photo:s.fbid,facebox:{fbid:u.fbid,x:u.x,y:u.y},recognition:v});}.bind(this));}.bind(this));this.inform('photo',{photo:s.fbid,faceboxes:s.faceboxes,recognitions:t});}.bind(this));if(!this._pendingPhotos.length){this._poller.stop();this._cleanup();this.inform('done',{unresolved:this._pendingPhotos});}};e.exports=p;},null);
__d("ComposerXNUX",["AsyncRequest","ComposerXDragDrop","CSS","DOM","Event","SubscriptionsHandler","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={},p={};function q(s,t,u){var v=u.dataTransfer.items;if(v){var w=h.filterImages(v);if(!w.length)return;}r.acknowledgeDialog(s,t);}var r={CAMERA_NUX:'camera_nux_seen',ADD_MORE_NUX:'add_more_nux_seen',HMU_NUX:'hmu_nux_seen',HMU_POST_NUX:'hmu_post_nux_seen',FACEREC_SUGGESTIONS_NUX:'facerec_suggestions_nux_seen',TAGGING_FLYOUT_NUX:'tagging_flyout_nux_seen',OGCOMPOSER_NEW_ICON_PICKER_NUX:'minutiae_icon_picker_nux_seen',SHARER_MINUTIAE_NUX:'sharer_minutiae_nux_seen',onInit:function(s,t,u){if(o[u])return;p[u]=p[u]||new l();var v=p[u];v.engage();var w=s.getRoot();i.addClass(w,"_4bka");var x=j.scry(w,"._3o-a");x.forEach(function(y){v.addSubscriptions(k.listen(y,'click',r.acknowledgeDialog.bind(null,u,s)));});if(u==r.CAMERA_NUX)v.addSubscriptions(k.listen(document,'dragenter',q.bind(null,u,s)));v.addSubscriptions(s.subscribe('cancel',r.sendMarkSeenRequest.bind(null,u)),s.subscribe('hide',v.release.bind(v)));s.setContext(t).show();},acknowledgeDialog:function(s,t){r.sendMarkSeenRequest(s);t.hide();},sendMarkSeenRequest:function(s){if(!o[s]){new g('/ajax/photos/composer/mark_nux_seen.php').setData({type:s}).send();o[s]=true;}},onCleanup:function(s){s.hide();}};e.exports=r;},null);
__d("AttachmentWithPhotosTaggingFlyoutMixin",["Event","Arbiter","PhotoTagStore","ComposerTagSuggestionsWaterfall","PhotosTaggingFlyoutLoader","BanzaiODS","FaceRecognitionController","ComposerXNUX","DOM","CSS","cx","csx","DOMQuery","isEmpty","fbt","Tooltip","Parent","Form","SubscriptionsHandler","copyProperties","PhotosUploadWaterfallXMixin","AsyncRequest","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){var da=[];e.exports=z(aa,{initTaggingFlyoutMixin:function(ea,fa){this._taggingFlyoutData={};this._taggingFlyoutData.root=ea.getRoot();this._taggingFlyoutData.gridID=ea.getGridID();this._taggingFlyoutData.uploadArea=ea.getUploadArea();this._taggingFlyoutData.submitButton=ea.getSubmitButton();this._taggingFlyoutData.tagger=ea.getTagger();this._taggingFlyoutData.scrollableArea=ea.getScrollableArea();this._taggingFlyoutData.config=fa;this._taggingFlyoutData.xyTagInputs={};this._taggingFlyoutData.subscriptions=new y();this._initTaggingFlyout();},setFaceRecSubmitButtonLock:function(ea){this._taggingFlyoutData.faceRecSubmitButtonLock=ea;},initTaggingFlyoutWithComponents:function(){this._taggingFlyoutData.subscriptions.addSubscriptions(h.subscribe('multi-upload/image-removed/'+this._taggingFlyoutData.gridID,this._doHandleImageRemoved.bind(this)),h.subscribe('multi-upload/images-added/'+this._taggingFlyoutData.gridID,this._doHandleImageAdded.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('recognition',this._doHandleRecognitionResult.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('photo',this._doHandlePhotoRecognitionDone.bind(this)),this._taggingFlyoutData.recognitionController.subscribe('done',function(ga,ha){this._taggingFlyoutData.faceRecSubmitButtonLock.unlock();this._setSubmitButtonTooltip('');ha.unresolved.forEach(function(ia){this._taggingFlyoutData.flyoutLoader.whenLoaded(ia,function(ja){ja.reset();});this._taggingFlyoutData.facerecLogger.bump('facerec_queries_fail');this._taggingFlyoutData.tagSuggestionsWaterfall.logFailure(ia,ha.user);this._doHandlePhotoRecognitionDone(ga,{photo:ia,faceboxes:[],recognitions:0});},this);this._taggingFlyoutData.facerecLogger.bump('facerec_queries_done');this._taggingFlyoutData.tagSuggestionsWaterfall.logStopPoll(Date.now()-this._taggingFlyoutData.pollLastStartedTimestamp,ha.unresolved.length);}.bind(this)));var ea=this.getComponentInstance('withtagger');if(ea)this._taggingFlyoutData.subscriptions.addSubscriptions(ea.subscribe('removeToken',this._doHandleTokenRemoved.bind(this)));i.getInstance().clear();var fa=this.getWaterfallID();this._taggingFlyoutData.tagSuggestionsWaterfall=new j(fa);this._taggingFlyoutData.tagSuggestionsWaterfall.logBegin();this._taggingFlyoutData.flowBeginTimestamp=Date.now();this._taggingFlyoutData.recognitionController.setWaterfallID(fa);},cleanupTaggingFlyout:function(){this._taggingFlyoutData.flyoutLoader.cleanup();if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)n.onCleanup(this._taggingFlyoutData.config.taggingFlyoutNUXDialog);this.releaseSubscriptions();this.engageSubscriptions();},resetTaggingFlyout:function(){i.getInstance().clear();this._taggingFlyoutData.recognitionController.stop();for(var ea in this._taggingFlyoutData.xyTagInputs)o.remove(this._taggingFlyoutData.xyTagInputs[ea]);this._taggingFlyoutData.xyTagInputs={};},getWaterfallID:function(){throw "Classes using AttachmentWithPhotosTaggingFlyoutMixin "+"should implement getWaterfallID";},releaseSubscriptions:function(){this._taggingFlyoutData.subscriptions.release();},engageSubscriptions:function(){this._taggingFlyoutData.subscriptions.engage();},addSubscriptions:function(){for(var ea=[],fa=0,ga=arguments.length;fa<ga;fa++)ea.push(arguments[fa]);var ha=this._taggingFlyoutData.subscriptions;ha.addSubscriptions.apply(ha,ea);},getSubscriptions:function(ea){return this._taggingFlyoutData.subscriptions;},logWithTaggingData:function(ea,fa){var ga=0,ha=this.getComponentInstance('withtagger');if(ha){var ia=i.getInstance(),ja=ha.getTokens();ga=ja.filter(function(ma){return !ia.userHasDirtyTags(ma.info.uid);}).length;var ka=ia.getAllTags(),la=ka.filter(function(ma){return ma.source=='composerx_suggestions';});this._taggingFlyoutData.tagSuggestionsWaterfall.logSubmit(ea,ja.length,ga,la.length,ka.length-la.length,Date.now()-this._taggingFlyoutData.flowBeginTimestamp);}return ga;},_initTaggingFlyout:function(){this._taggingFlyoutData.flyoutLoader=new k(this._taggingFlyoutData.config.targetID);this._taggingFlyoutData.flyoutLoader.subscribe('loaded',function(ea,fa){this._setupTaggingFlyout(fa);}.bind(this));this._taggingFlyoutData.facerecLogger={bump:function(ea,fa){l.bumpEntityKey('composer_facerec_suggestions',ea,fa);}};this._taggingFlyoutData.recognitionController=new m({targetID:this._taggingFlyoutData.config.targetID,targetIsPage:this._taggingFlyoutData.config.targetIsPage});},_setupTaggingFlyout:function(ea){da.push(ea);if(!this._getPhotoGridItem(ea.getPhotoID()))return;this._taggingFlyoutData.subscriptions.addSubscriptions(ea.subscribe('show',this._onTaggingFlyoutShow.bind(this,ea)),ea.subscribe('beforehide',this._onTaggingFlyoutHide.bind(this,ea)),ea.subscribe('confirm',this._onTaggingFlyoutConfirmed.bind(this,ea)),ea.subscribe('select',this._onTaggingFlyoutSelect.bind(this,ea)),ea.subscribe('unselect',this._onTaggingFlyoutUnselect.bind(this,ea)));},_onTaggingFlyoutShow:function(ea,fa,ga){if(this._taggingFlyoutData.config.taggingFlyoutNUXDialog)n.acknowledgeDialog(n.TAGGING_FLYOUT_NUX,this._taggingFlyoutData.config.taggingFlyoutNUXDialog);ea.setNextButtonVisibility(!this._findNextTaggableGridItem(this._getPhotoGridItem(ea.getPhotoID())));},_onTaggingFlyoutHide:function(ea,fa,ga){p.removeClass(ea.getContext(),"_58pl");p.conditionClass(this._taggingFlyoutData.uploadArea,"_58pk",s.scry(this._taggingFlyoutData.uploadArea,"._58pl").length);},_onTaggingFlyoutConfirmed:function(ea,fa,ga){var ha=this._findNextTaggableGridItem(this._getPhotoGridItem(ea.getPhotoID()));if(!ha)return;if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(ha);p.addClass(this._taggingFlyoutData.uploadArea,"_58pk");p.addClass(ha,"_58pl");this._getTaggingFlyout(ha.getAttribute('data-fbid'),function(ia){ia.show(ha);});},_onTaggingFlyoutSelect:function(ea,fa,ga){p.addClass(this._getPhotoGridItem(ea.getPhotoID()),"_57vj");var ha=i.getInstance().userHasDirtyTags(ga.user);if(!ha)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');i.getInstance().storeTagWithOptions(ga.photo,ga.user,ga.facebox.x,ga.facebox.y,{fbid:ga.photo,name:ga.name,subject:ga.user,from_facebox:true,facebox:ga.facebox.fbid,source:'composerx_flyout'});this._taggingFlyoutData.tagSuggestionsWaterfall.logAddManualTag(ga.photo,ga.facebox.fbid,ga.user);var ia=this.getComponentInstance('withtagger');if(ia)if(!ha){var ja=ia.replaceToken(ia.createDecorativeToken({uid:ga.user,text:ga.name},'faceSuggestion'));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(ga.user,ja);}this._updateXYTagInputs();},_onTaggingFlyoutUnselect:function(ea,fa,ga){this._fireDismissRequest([{facebox:ga.facebox,log_data:{tagee:ga.user,is_first:true}}]);var ha=i.getInstance().removeTag(ga.photo,ga.user);if(t(ha))return;var ia=this._taggingFlyoutData.tagSuggestionsWaterfall;ha.forEach(function(la){if(la.source=='composerx_suggestions'){ia.logRemoveSuggestion(la.fbid,la.facebox,la.subject,la.certainty);}else ia.logRemoveManualTag(la.fbid,la.facebox,la.subject);});p.conditionClass(this._getPhotoGridItem(ea.getPhotoID()),"_57vj",!t(i.getInstance().getPhotoTags(ga.photo)));var ja=i.getInstance().userHasDirtyTags(ga.user),ka=this.getComponentInstance('withtagger');if(ka&&!ja){ka.removeToken(ka.findToken({uid:ga.user}));this._taggingFlyoutData.tagSuggestionsWaterfall.logRemoveToken(ga.user,0);}this._updateXYTagInputs();},_doHandleImageRemoved:function(ea,fa){this._taggingFlyoutData.flyoutLoader.remove(fa);var ga=0,ha=[],ia=this.getComponentInstance('withtagger');if(ia){ha=Object.keys(i.getInstance().getPhotoTags(fa));i.getInstance().removeAllTagsFromPhoto(fa);ha.forEach(function(ja){if(!i.getInstance().userHasDirtyTags(ja)){ga++;ia.removeToken(ia.findToken({uid:ja}));}});}this._taggingFlyoutData.tagSuggestionsWaterfall.logRemovePhoto(fa,ga,ha.length);this._updateXYTagInputs();da.forEach(function(ja){return ja.hide();});},_doHandleImageAdded:function(ea,fa){if(fa.disableRecognition)return;Object.keys(fa.fbids).forEach(function(ga){var ha=fa.fbids[ga],ia=this._getPhotoGridItem(ha);if(ia)p.addClass(ia,"_57vh");},this);this._taggingFlyoutData.tagSuggestionsWaterfall.logAddPhotos(ca(fa.fbids));this._taggingFlyoutData.facerecLogger.bump('photos_queried');if(this.getComponent('withtagger')&&!this._taggingFlyoutData.config.hideWithTagger)this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');if(!this._taggingFlyoutData.config.applyTagSuggestionsDelay)this._taggingFlyoutData.faceRecSubmitButtonLock.lock();this._taggingFlyoutData.recognitionController.start(ca(fa.fbids));this._setSubmitButtonTooltip("Processing");this._taggingFlyoutData.pollLastStartedTimestamp=Date.now();this._taggingFlyoutData.tagSuggestionsWaterfall.logStartPoll(Object.keys(fa.fbids).length);},_doHandleRecognitionResult:function(ea,fa){var ga=fa.facebox,ha=fa.recognition,ia=i.getInstance().userHasDirtyTags(ha.user.fbid);this._taggingFlyoutData.facerecLogger.bump('xy_tags_added');this._taggingFlyoutData.tagSuggestionsWaterfall.logAddSuggestion(fa.photo,ga.fbid,ha.user.fbid,ha.certainty);if(!ia)this._taggingFlyoutData.facerecLogger.bump('suggestion_tags_added');i.getInstance().storeTagWithOptions(fa.photo,ha.user.fbid,ga.x,ga.y,{fbid:fa.photo,name:ha.user.name,subject:ha.user.fbid,from_facebox:true,facebox:ga.fbid,certainty:ha.certainty,source:'composerx_suggestions',timestamp:Date.now()});var ja=this.getComponentInstance('withtagger');if(ja){if(!ia){var ka=ja.replaceToken(ja.createDecorativeToken({uid:ha.user.fbid,text:ha.user.name},this._taggingFlyoutData.config.additionalTokensGlyph));this._taggingFlyoutData.tagSuggestionsWaterfall.logAddToken(ha.user.fbid,ka);}this._taggingFlyoutData.tagger.eventuallySwitchToTagger('with');}setTimeout(this._updateXYTagInputs.bind(this),this._taggingFlyoutData.config.applyTagSuggestionsDelay?500:0);},_doHandlePhotoRecognitionDone:function(ea,fa){var ga=fa.photo,ha=this._getPhotoGridItem(ga);if(!ha)return;p.removeClass(ha,"_57vh");if(!this._taggingFlyoutData.config.useTaggingFlyout)return;p.addClass(ha,"_57vi");p.conditionClass(ha,"_57vj",fa.recognitions);p.conditionClass(ha,"_57vk",fa.faceboxes.length);if(fa.recognitions&&this._taggingFlyoutData.config.taggingFlyoutNUXDialog&&!this._taggingFlyoutData.taggingFlyoutNUXShown){this._scrollIntoView(ha);n.onInit(this._taggingFlyoutData.config.taggingFlyoutNUXDialog,ha,n.TAGGING_FLYOUT_NUX);this._taggingFlyoutData.taggingFlyoutNUXShown=true;}var ia=s.find(ha,'.fbVaultGridImage');this._taggingFlyoutData.subscriptions.addSubscriptions(g.listen(ia,'click',function(ja){p.addClass(this._taggingFlyoutData.uploadArea,"_58pk");p.addClass(ha,"_58pl");this._getTaggingFlyout(ga,function(ka){ka.toggle(ha);});}.bind(this)));},_setSubmitButtonTooltip:function(ea){var fa=s.find(this._taggingFlyoutData.root,"._yo");if(ea){v.set(fa,ea,'above','center');}else{v.remove(fa);fa.setAttribute('aria-label',"Post");}},_doHandleTokenRemoved:function(ea,fa){var ga=i.getInstance(),ha=fa.info.uid,ia=this._taggingFlyoutData;if(ga.userHasDirtyTags(ha)){var ja=ga.userDirtyTagsCount(ha);ia.tagSuggestionsWaterfall.logRemoveToken(ha,ja);ia.facerecLogger.bump('suggestion_tokens_removed');ia.facerecLogger.bump('xy_tags_removed',ja);}var ka=[],la=this._getPhotoGridItem;ga.removeAllNewTagsOfUser(ha).forEach(function(ma){ka.push({facebox:ma.facebox,log_data:{tagee:ma.subject,is_first:true}});if(ia.config.useTaggingFlyout){if(!ga.photoHasTags(ma.fbid))p.removeClass(la(ma.fbid),"_57vj");ia.flyoutLoader.whenLoaded(ma.fbid,function(na){na.getFaceboxInstance(ma.facebox).reset();});}if(ma.source=='composerx_suggestions'){ia.tagSuggestionsWaterfall.logRemoveSuggestion(ma.fbid,ma.facebox,ma.subject,ma.certainty);}else ia.tagSuggestionsWaterfall.logRemoveManualTag(ma.fbid,ma.facebox,ma.subject);});this._fireDismissRequest(ka);this._updateXYTagInputs();},_updateXYTagInputs:function(){var ea=w.byTag(this._taggingFlyoutData.submitButton,'form');for(var fa in this._taggingFlyoutData.xyTagInputs)o.remove(this._taggingFlyoutData.xyTagInputs[fa]);var ga=i.getInstance().getAllTags();if(this._taggingFlyoutData.config.applyTagSuggestionsDelay)ga=ga.filter(function(ha){return !ha.timestamp||(ha.timestamp+500<=Date.now());});x.createHiddenInputs({xy_tags:ga},ea,this._taggingFlyoutData.xyTagInputs);},_getPhotoGridItem:function(ea){return s.scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem[data-fbid="'+ea+'"]')[0];},_findNextTaggableGridItem:function(ea){var fa=s.scry(this._taggingFlyoutData.uploadArea,'.fbVaultGridItem'),ga=fa.indexOf(ea);while(++ga<fa.length)if(p.hasClass(fa[ga],"_57vk"))break;return fa[ga];},_getTaggingFlyout:function(ea,fa){this._taggingFlyoutData.flyoutLoader.get(ea,fa);},_fireDismissRequest:function(ea){if(ea.length>0)new ba().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:ea,closing_source:'composerx_suggestions',closing_action:'no'}).setAllowCrossPageTransition(true).send();},_scrollIntoView:function(ea){if(this._taggingFlyoutData.scrollableArea)this._taggingFlyoutData.scrollableArea.scrollIntoView(ea);}});},null);
__d("ComposerXPrivacyWidgetTags",["Arbiter","CurrentUser","PrivacySelectorBase","copyProperties","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){"use strict";var n=m.getComponent('mainprivacywidget');if(!n){this._subscriptions=[];return null;}this._privacyWidget=n.element;this._privacyWidgetInstance=n.instance&&n.instance.getInstance().getInstance();this._mentionsInput=m.getComponent('maininput').instance;this._placeTypeahead=m.getComponent('placetagger')?m.getComponent('placetagger').instance:null;this._friendsTokenizer=m.getComponent('withtagger')?m.getComponent('withtagger').instance:null;this._init();}l.prototype._init=function(){"use strict";this._subscriptions=[this._mentionsInput.subscribe('update',this._informChangedTags.bind(this))];if(this._placeTypeahead){this._subscriptions.push(this._placeTypeahead.subscribe('select',this._onPlaceSelect.bind(this)));this._subscriptions.push(g.subscribe('Events/autoSuggestionSelected',this._onPlaceSelect.bind(this)));this._subscriptions.push(this._placeTypeahead.subscribe('unselect',this._onPlaceUnselect.bind(this)));}if(this._friendsTokenizer)this._subscriptions.push(this._friendsTokenizer.subscribe(['addToken','removeToken'],this._informChangedTags.bind(this)));this._informChangedTags();};l.prototype._getTaggedNamesForAudience=function(){"use strict";var m={},n=this._mentionsInput.getMentions();for(var o in n)if(n[o].type=='user')m[o]=n[o].text;if(this._friendsTokenizer)this._friendsTokenizer.getTokens().map(function(p){m[p.getValue()]=p.getText();});delete m[h.getID()];return k(m);};l.prototype._onPlaceSelect=function(m,n){"use strict";this._placeType=n.selected.place_type;this._informChangedTags();};l.prototype._onPlaceUnselect=function(m,n){"use strict";this._placeType=null;this._informChangedTags();};l.prototype._informChangedTags=function(){"use strict";var m=[];if(this._friendsTokenizer)m=this._friendsTokenizer.getTokens();var n=null;if(this._placeType==='Event')n=this._placeTypeahead.getCore().getHiddenValue();var o={withTags:m,mention:this._mentionsInput.getMentions(),eventTag:n};g.inform('Composer/changedtags',o);if(this._privacyWidgetInstance&&this._privacyWidgetInstance instanceof i)this._privacyWidgetInstance.informTagsChanged(o);};l.prototype.destroy=function(){"use strict";while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();};j(l.prototype,{_subscriptions:null,_placeType:null});e.exports=l;},null);
__d("ComposerXMediaUploadAttachment",["Arbiter","Button","ComposerXAttachment","ComposerXAttachmentUtils","ComposerXAttachmentButtonBarState","ComposerXAttachmentPrefillMixin","ComposerXPrivacyWidgetTags","ComposerXSessionIDInserter","Dialog","DOM","DOMQuery","Event","PagesBanzaiLogger","PagesComposerEntryLogger","Parent","SubscriptionsHandler","classWithMixins","copyProperties","csx","cx","ge","fbt","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){var da=w(i,ca(l));for(var ea in da)if(da.hasOwnProperty(ea))ga[ea]=da[ea];var fa=da===null?null:da.prototype;ga.prototype=Object.create(fa);ga.prototype.constructor=ga;ga.__superConstructor__=da;function ga(ha,ia,ja){"use strict";da.call(this);this._root=ha;this._tagger=ia;this._config=ja;this._hasSelected=false;this._subscriptions=new v();this._uploadArea=p.find(this._root,"div._yn");this._submitButton=p.find(this._root,"._yo");}ga.prototype.getRoot=function(){"use strict";return this._root;};ga.prototype.getUploadArea=function(){"use strict";return this._uploadArea;};ga.prototype.getSubmitButton=function(){"use strict";return this._submitButton;};ga.prototype.getTagger=function(){"use strict";return this._tagger;};ga.prototype.initWithComponents=function(){"use strict";this._initFileInput();var ha=this.getComponent('maininput');j.initMentions(ha,this._config.mentionsPlaceholder,this.getComposerID(),{dontFocusMentions:this._config.dontFocusMentions});var ia=q.find(ha.element,'textarea.input');if(!ia.value&&this._config.targetIsPage){this._pagesComposerEntryLogger=new t(this._config.targetID);this._pagesComposerEntryLogger.registerForContentEntryEvents(ia);}if(this._config.prefill)this._initPrefill(q.find(this.getComponent('maininput').element,'textarea.input'),this._config.prefill);this._root.action=this._config.photoEndpoint;this._tagger.init(this);this._privacyWidgetTags=new m(this);k.trackCityChanges(this);g.inform('ComposerXMediaUpload/start');var ja=this._config.fileForm;this._subscriptions.addSubscriptions(ja.subscribe('submit',function(){n.insertSessionInput(ja.getRoot());}.bind(this)));if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);g.inform('composer/render_pab_nux');};ga.prototype.cleanup=function(){"use strict";this._tagger.cleanup();this._privacyWidgetTags&&this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._subscriptions.release();this._subscriptions.engage();if(this._pagesComposerEntryLogger)this._pagesComposerEntryLogger.unregister();};ga.prototype.reset=function(){"use strict";this._tagger.reset();this._resetFileInput();if(this._config.prefill)this._resetPrefill();};ga.prototype._resetFileInput=function(){"use strict";p.replace(this._fileInput,this._fileInputCopy);this._initFileInput();};ga.prototype.canSwitchAway=function(){"use strict";return !u.byClass(this._root,'async_saving');};ga.prototype._setSubmitButtonEnabled=function(ha){"use strict";h.setEnabled(this._submitButton,ha);};ga.prototype._isImageFile=function(){"use strict";return !!this._config.imageExtensions[this._getFileExtension()];};ga.prototype._getFileExtension=function(){"use strict";return this._fileInput.value.split('.').pop().toLowerCase();};ga.prototype._initFileInput=function(){"use strict";this._fileInput=p.find(this._root,"._n");this._fileInputCopy=this._fileInput.cloneNode(false);this._subscriptions.addSubscriptions(r.listen(this._fileInput,'change',this._onFileChange.bind(this)));};ga.prototype._onFileChange=function(){"use strict";if(this._isImagesOnly()&&!this._isImageFile()){new o().setTitle("Invalid Image File").setBody("Please upload a valid image file.").setModal(true).setButtons([o.OK]).show();this._resetFileInput();}else{p.setContent(aa('fbComposerUploadMediaFilename'),this._fileInput.value.split('\\').pop());this._setSubmitButtonEnabled(!!this._fileInput.value);}var ha=this._getPageSelectLoggingData();if(ha&&!this._hasSelected&&this._fileInput.value){this._hasSelected=true;s.logData(ha,null);}};ga.prototype._isImagesOnly=function(){"use strict";return !!this._config.imagesOnly;};ga.prototype._getPageSelectLoggingData=function(){"use strict";return this._config.pageSelectLoggingData;};x(ga.prototype,{_privacyWidgetTags:null,attachmentClassName:"_92"});e.exports=ga;},null);
__d("Lockable",[],function(a,b,c,d,e,f){function g(i,j){"use strict";this._onUnlock=i;this._onLock=j;this._isLocked=false;this._locks=[];}g.prototype.getLock=function(){"use strict";var i=new h(this._onLockChanged.bind(this));this._locks.push(i);return i;};g.prototype._onLockChanged=function(){"use strict";var i=this._locks.some(function(j){return j.isLocked();});if(i!==this._isLocked){this._isLocked=i;if(i){this._onLock();}else this._onUnlock();}};function h(i){"use strict";this._isLocked=false;this._onChange=i;}h.prototype.lock=function(){"use strict";if(!this._isLocked){this._isLocked=true;this._onChange();}return this;};h.prototype.unlock=function(){"use strict";if(this._isLocked){this._isLocked=false;this._onChange();}return this;};h.prototype.isLocked=function(){"use strict";return this._isLocked;};e.exports=g;},null);
__d("VaultComposerController",["Arbiter","CSS","SubscriptionsHandler","areEqual","copyProperties","emptyFunction","removeFromArray","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q){this._uploadedImageCount=0;this._uploadingImageCount=0;this._subscriptionsHandler=new i();this._hasVideo=false;this._singleSelect=false;this._multiselectElems=q;this._initialPhotoFbids=[];this._photoFbids=[];this.setAllMediaRemovedHandler(l);this._subscriptionsHandler.addSubscriptions(g.subscribe('multi-upload/images-added/'+p,function(r,s){var t=Object.keys(s.fbids),u=t.length;this._uploadingImageCount=Math.max(0,this._uploadingImageCount-u);this._uploadedImageCount+=u;if(this._uploadingImageCount>0)return;t.forEach(function(v){var w=s.fbids[v];this._photoFbids.push(w);if(s.initialPhoto)this._initialPhotoFbids.push(w);}.bind(this));this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/image-removed/'+p,function(r,s){this._uploadedImageCount--;m(this._photoFbids,s);this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/images-upload-completed/'+p,function(r,s){this._uploadingImageCount=0;this._onImagesChanged();}.bind(this)),g.subscribe('multi-upload/video-added/'+p,function(){q.forEach(h.hide);this._enableComposerHandler(true);this._placeholderHandler("Say something about this video...","Where was this video taken?");this._hasVideo=true;}.bind(this)),g.subscribe('multi-upload/video-removed/'+p,function(){q.forEach(h.show);this._enableComposerHandler(false);this._placeholderHandler("Say something about this...","Where was this taken?");this._hasVideo=false;this._allMediaRemovedHandler();}.bind(this)),g.subscribe('multi-upload/images-upload-start/'+p,function(r,s){this._uploadingImageCount+=s.imageCount;this._enableComposerHandler(false);var t=this.getTotalImageCount();this._placeholderHandler(o.getPlaceholderText(t),o.getPlacePickerPlaceholderText(t));this._checkForSingleSelect();}.bind(this)),g.subscribe('multi-upload/all-images-removed/'+p,function(){q.forEach(h.show);this._uploadedImageCount=0;this._uploadingImageCount=0;this._enableComposerHandler(false);this._placeholderHandler("Say something about this...","Where was this taken?");this._photoFbids.length=0;this._allMediaRemovedHandler();}.bind(this)));}k(o,{getPlaceholderText:function(p){if(p===0){return "Say something about this...";}else if(p==1){return "Say something about this photo...";}else return "Say something about these photos...";},getPlacePickerPlaceholderText:function(p){if(p===0){return "Where was this taken?";}else if(p==1){return "Where was this photo taken?";}else return "Where were these photos taken?";}});k(o.prototype,{setEnableComposerHandler:function(p){this._enableComposerHandler=p;return this;},setPlaceholderHandler:function(p){this._placeholderHandler=p;return this;},setAllMediaRemovedHandler:function(p){this._allMediaRemovedHandler=p;return this;},setSingleSelect:function(p){this._singleSelect=p;return this;},cleanup:function(){this._uploadedImageCount=0;this._uploadingImageCount=0;this._initialPhotoFbids.length=0;this._photoFbids.length=0;this._subscriptionsHandler.release();},_checkForSingleSelect:function(){if(this._singleSelect)this._multiselectElems.forEach(function(p){h.conditionShow(p,this.getTotalImageCount()===0);}.bind(this));},getTotalImageCount:function(){return this._uploadingImageCount+this._uploadedImageCount;},_onImagesChanged:function(){this._enableComposerHandler(this._uploadedImageCount>0);this._placeholderHandler(o.getPlaceholderText(this._uploadedImageCount),o.getPlacePickerPlaceholderText(this._uploadedImageCount));this._checkForSingleSelect();if(this._uploadedImageCount===0&&this._uploadingImageCount===0)this._allMediaRemovedHandler();},hasChanges:function(){var p=!j(this._photoFbids,this._initialPhotoFbids);return p||this._hasVideo;}});e.exports=o;},null);
__d("XComposerXAddPhotoItemController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/composerx\/photo\/item\/",{photo_fbid:{type:"Int",required:true},grid_id:{type:"String",required:true},image_height:{type:"Int",required:true},image_width:{type:"Int",required:true}});},null);
__d("ComposerXMediaUploadPlusAttachment",["Event","Arbiter","ComposerXAttachmentUtils","ComposerXController","ComposerXDragDrop","ComposerXMediaUploadAttachment","CSS","DOM","Lockable","Parent","PhotosMultiUploadInput","PUWApplications","VaultComposerController","AsyncRequest","csx","cx","ge","mixin","classWithMixins","AttachmentWithPhotosTaggingFlyoutMixin","PUWSteps","SubscriptionsHandler","XComposerXAddPhotoItemController"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca){var da=y(l,x(z));for(var ea in da)if(da.hasOwnProperty(ea))ga[ea]=da[ea];var fa=da===null?null:da.prototype;ga.prototype=Object.create(fa);ga.prototype.constructor=ga;ga.__superConstructor__=da;function ga(ha,ia,ja,ka,la){"use strict";if(la&&la.getUploadInput().getGrid)this._grid=la.getUploadInput().getGrid();da.call(this,ha,ia,ja);this._gridID=this._uploadArea.id;this._controller=null;this._cameraIcon=null;this._eventSuggestionQuerySent=false;this._submitButtonLockable=null;this._cleaningUp=false;this._resetting=false;this._photoCount=0;this._scrollableArea=ka;if(this._config.warningDialog)this._config.warningDialog.setContext(this._submitButton);if(this._supportsDragDrop())if(this._grid){this._grid.initDragDrop(this._root);}else q.initDragDrop(this._gridID,this._root);this.initTaggingFlyoutMixin(this,ja);this._photosToInit=this._config.existingPhotos;if(this._config.qualityChooser)this._config.qualityChooser.addListener('checkboxChanged',function(ma){la.getUploadInput().onQualitySettingChanged(ma);new t().setURI('/ajax/photos/upload/settings/').setData({composer_resolution:ma?'high':'standard'}).send();});}ga.prototype.getGrid=function(){"use strict";return this._grid;};ga.prototype.getGridID=function(){"use strict";return this._gridID;};ga.prototype.getWaterfallID=function(){"use strict";if(this._grid){return this._grid.getWaterfallID();}else return q.getWaterfallID(this._gridID);};ga.prototype.getWaterfallAppName=function(){"use strict";return r.WEB_COMPOSER;};ga.prototype.getScrollableArea=function(){"use strict";return this._scrollableArea;};ga.prototype.initWithComponents=function(){"use strict";fa.initWithComponents.call(this);this.addSubscriptions(h.subscribe('multi-upload/images-upload-start/'+this._gridID,this._onUploadStart.bind(this)),h.subscribe('multi-upload/composer-reset/'+this._gridID,this._handleMultiUploadComposerReset.bind(this)),h.subscribe('multi-upload/images-added/'+this._gridID,this._handleImageAdded.bind(this)),h.subscribe('multi-upload/image-removed/'+this._gridID,this._handleImageRemoved.bind(this)),g.listen(this._root,'submit',this._onSubmit.bind(this),g.Priority.URGENT));this.initTaggingFlyoutWithComponents();this._cameraIcon=this.getComponent('cameraicon');this._moreLink=n.find(this._root,"._2oh");m.conditionShow(this._moreLink,this._config.isMediaModifiable);var ha=[this._moreLink];this._cameraIcon&&ha.push(this._cameraIcon.element);this._controller=new s(this._gridID,ha).setSingleSelect(this._config.maxSelect===1).setPlaceholderHandler(this._setPlaceholders.bind(this));j.registerConditionForComposerCancel&&j.registerConditionForComposerCancel(this.getComposerID(),function(){return this._controller.hasChanges();}.bind(this));this._resetSubmitButtonLockable();var ia;if(!this._config.allowNoMedia){ia=this._submitButtonLockable.getLock().lock();this._controller.setEnableComposerHandler(function(ja){if(ja){ia.unlock();}else ia.lock();}).setAllMediaRemovedHandler(function(){if(!this._cleaningUp&&!this._resetting)if(j.hasAttachmentWithClassName(this._root,"_4j")){j.getAttachment(this._root,'/ajax/composerx/attachment/status/');}else if(this._config.editPostID)j.getAttachment(this._root,this._config.statusAttachmentEndpoint);}.bind(this));}else{ia=this._submitButtonLockable.getLock().unlock();this._controller.setEnableComposerHandler(function(ja){ia.unlock();});}if(!this._fileHandler)this._fileHandler=h.subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/mediaupload',function(ja,ka){if(this._grid){this._grid.doFileUpload(ka.fileInput);}else q.doFileUpload(this._gridID,ka.fileInput);}.bind(this));if(!this._cameraPhotoHandler)this._cameraPhotoHandler=h.subscribe('ComposerXFilesStore/filesAdded/'+this._composerID+'/cameraphoto',function(ja,ka){var la=ca.getURIBuilder().setInt('photo_fbid',ka.photoFBID).setString('grid_id',this._gridID).setInt('image_width',this._config.thumbnailSize.width).setInt('image_height',this._config.thumbnailSize.height).getURI();new t(la).send();}.bind(this));if(this._supportsDragDrop()&&!this._dragdropHandler){this._dragdropHandler=h.subscribe('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',function(ja,ka){if(this._grid){this._grid.onFilesDrop(ka.files);}else q.onFilesDrop(this._gridID,ka.files);}.bind(this));k.handleDragEnterAndLeave(this._root);}if(this._photosToInit){this._photosToInit.forEach(function(ja){h.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:{'0':''+ja},tagInfo:{},disableRecognition:true,initialPhoto:true});}.bind(this));this._photosToInit=null;}m.conditionShow(this._scrollableArea.getRoot(),this._config.isMediaModifiable||this._photoCount>0);if(this._config.postActionsButton!=null)this._config.postActionsButton.initHiddenInputs(this.getComponent('pabhiddeninputs').instance);};ga.prototype.reset=function(){"use strict";this._resetting=true;this.resetTaggingFlyout();this._removeAllImages();this.getTagger().reset();this._eventSuggestionQuerySent=false;if(this._config.isAutoEventSuggestionEnabled){var ha=w('event_tagging_auto_suggestion');ha&&m.hide(ha);}this._resetting=false;if(this._config.prefill)this._resetPrefill();};ga.prototype._handleImageAdded=function(ha,ia){"use strict";this._setPhotoCount(this._photoCount+Object.keys(ia.fbids).length);if(this._config.preShowWithTagger&&this.getComponent('withtagger'))this.getTagger().eventuallySwitchToTagger('with');if(ia.tagInfo.exifLocation&&ia.tagInfo.exifLocation.latitude&&ia.tagInfo.exifLocation.longitude){this.getTagger()._placeTagger.instance.getCore().setLocation(ia.tagInfo.exifLocation);if(this._config.exifUsePlaceComposerFlow)this.getTagger().eventuallySwitchToTagger('place');}if(!this._config.isAutoEventSuggestionEnabled)return;if(this.getComponent('hiddenplaceinput').element.value)return;if(this._eventSuggestionQuerySent)return;this._sendEventsSuggestionRequest({fbid:ia.fbids[Object.keys(ia.fbids)[0]],anchor_id:'composerCityTagger'});this._eventSuggestionQuerySent=true;};ga.prototype._handleImageRemoved=function(ha,ia){"use strict";this._setPhotoCount(this._photoCount-1);};ga.prototype._handleMultiUploadComposerReset=function(){"use strict";this._resetting=true;this._removeAllImages();this._resetting=false;};ga.prototype.cleanup=function(){"use strict";this._cleaningUp=true;this.cleanupTaggingFlyout();fa.cleanup.call(this);h.inform('multi-upload/video-removed/'+this._gridID);this._removeAllImages();this._controller.cleanup();this._moreLinkListener&&this._moreLinkListener.remove();if(this.getComponent('withtagger'))this._withTaggerIconListener&&this._withTaggerIconListener.remove();this._cleaningUp=false;};ga.prototype.canSwitchAway=function(){"use strict";return !p.byClass(this._root,'async_saving');};ga.prototype._supportsDragDrop=function(){"use strict";return this._config.maxSelect!==1;};ga.prototype._setPlaceholders=function(ha,ia){"use strict";i.setStickyPlaceholderForMentions(this.getComponent('maininput'),ha);i.setStickyPlaceholderForTypeahead(this.getComponent('placetagger').element,ia);this._cameraIcon&&m.conditionClass(this._cameraIcon.element,"_1dsx",this._controller.getTotalImageCount()>0);};ga.prototype._resetSubmitButtonLockable=function(){"use strict";this._submitButtonLockable=new o(this._setSubmitButtonEnabled.bind(this,true),this._setSubmitButtonEnabled.bind(this,false));this._overImageSelectionLimitLock=this._submitButtonLockable.getLock();this.setFaceRecSubmitButtonLock(this._submitButtonLockable.getLock());};ga.prototype._onUploadStart=function(){"use strict";var ha=n.find(this._root,'.fbScrollableAreaWrap');ha.scrollLeft=Math.max(0,n.find(this._root,'.fbScrollableAreaBody').offsetWidth-ha.offsetWidth);};ga.prototype._sendEventsSuggestionRequest=function(ha){"use strict";new t('ajax/events/tagging/suggestion_query').setData(ha).setHandler(null).send();};ga.prototype._initFileInput=function(){"use strict";};ga.prototype._onSubmit=function(){"use strict";var ha=Date.now(),ia=this.logWithTaggingData(this._photoCount,this.getComposerID()),ja={volume:this._photoCount,with_tag_count:ia};this.logStep(aa.CLIENT_PUBLISH_BEGIN,ja);var ka=new ba();ka.addSubscriptions(g.listen(this._root,'success',function(la){ja.dt=Date.now()-ha;this.logStep(aa.CLIENT_PUBLISH_SUCCESS,ja);this.logStep(aa.CLIENT_FLOW_SUCCESS);ka.release();}.bind(this)),g.listen(this._root,'error',function(la){ja.dt=Date.now()-ha;la=la.getData().response;if(la){ja.error_code=la.getError();ja.error_info=la.getErrorDescription();}this.logStep(aa.CLIENT_PUBLISH_FAIL,ja);ka.release();}.bind(this)));};ga.prototype._removeAllImages=function(){"use strict";this._setPhotoCount(0);n.scry(this._root,"._yr").forEach(function(ha){if(!m.hasClass(ha,"_2oh"))n.remove(ha);});if(this._grid){this._grid.clearSession();}else q.clearSession(this._gridID);h.inform(['multi-upload/all-images-removed/'+this._gridID,'multi-upload/all-images-removed']);};ga.prototype._setPhotoCount=function(ha){"use strict";this._photoCount=ha;if(this._config.maxSelect>1)if(this._photoCount>this._config.maxSelect){this._config.warningDialog.show();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.lock();}else{this._config.warningDialog.hide();if(this._overImageSelectionLimitLock)this._overImageSelectionLimitLock.unlock();}};e.exports=ga;},null);
__d("GroupSellLogger",["BanzaiLogger","GroupSellUserActionEvents"],function(a,b,c,d,e,f,g,h){var i={logComposerTooltipNUXSeen:function(j){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_TOOLTIP_NUX_SEEN,group_id:j});},logComposerLoad:function(j){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_LOAD,group_id:j});},logLaunchSellComposer:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.LAUNCH_SELL_COMPOSER,group_id:j,is_edit:k});},logLaunchNormalComposer:function(j){g.log('GroupSellUserActionsLoggerConfig',{event:h.LAUNCH_NORMAL_COMPOSER,group_id:j});},logComposerFillTitle:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_FILL_TITLE,group_id:j,is_edit:k});},logComposerFillPrice:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_FILL_PRICE,group_id:j,is_edit:k});},logComposerFillDescription:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_FILL_DESCRIPTION,group_id:j,is_edit:k});},logComposerFillPickupNote:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_FILL_PICKUP_NOTE,group_id:j,is_edit:k});},logComposerDeletePhoto:function(j,k){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_DELETE_PHOTO,group_id:j});},logComposerSubmit:function(j,k,l,m,n,o,p,q){g.log('GroupSellUserActionsLoggerConfig',{event:h.COMPOSER_SUBMIT,group_id:j,title:k,price_currency:l,price_amount:m,description:n,pickup_note:o,num_photos:p,is_edit:q});}};e.exports=i;},null);
__d("ComposerXSellAttachmentMixin",["Arbiter","ComposerXController","CSS","DOM","Focus","Input","Event","GroupSellLogger","Parent","SubscriptionsHandler","URI","URLScraper","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u={initSellInputs:function(){var v=this.getComponent('forsale').instance,w=this.getComponent('forsaleextras').instance;if(this._linkShare){k.set(this._getDescriptionTextarea());}else if(!this._config.isDefaultComposer)k.set(v.getTitleInput());this._inputsEverChanged={title:false,price:false,description:false,pickupNote:false};if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}this._sellInputListeners=new p();this._sellInputListeners.addSubscriptions(m.listen(v.getTitleInput(),'input',this._inputsChanged.bind(this)),m.listen(v.getTitleInput(),'change',this._inputsChanged.bind(this)),m.listen(v.getPriceInput(),'input',this._inputsChanged.bind(this)),m.listen(v.getPriceInput(),'change',this._inputsChanged.bind(this)),m.listen(this.getComponent('maininput').element,'input',this._inputsChanged.bind(this)),m.listen(this.getComponent('maininput').element,'change',this._inputsChanged.bind(this)),m.listen(w.getPickupNoteInput(),'input',this._inputsChanged.bind(this)),m.listen(w.getPickupNoteInput(),'change',this._inputsChanged.bind(this)),m.listen(this.getSubmitButton(),'click',this._logComposerSubmitted.bind(this)));this._inputsChanged();var x=j.scry(this._root,"._9s")[0];if(x)this._sellInputListeners.addSubscriptions(m.listen(x,'click',this._removeLinkAttachment.bind(this)));this._urlScraper=new r(this.getComponent('maininput').element,function(){return this.getComponent('maininput').instance.getValue();}.bind(this));this._scraperListener=this._urlScraper.subscribe('match',function(y,z){if(this._hasPhotos||x||this._config.isEditComposer)return;var aa=new q(this._config.scraperEndpoint);aa.addQueryData({scrape_url:encodeURIComponent(z.url)});h.getAttachment(this._root,aa.toString());}.bind(this));this.setHasPhotos(this.getPhotoCount()>0);this._controller.setPlaceholderHandler(function(){});if(!this._config.isEditComposer)n.logComposerLoad(this._config.targetID);this._logLaunchSellComposer();},resetSellInputs:function(){if(this._sellInputListeners){this._sellInputListeners.release();this._sellInputListeners=null;}if(this._urlScraper){this._urlScraper.disable();this._urlScraper.reset();this._urlScraper=null;}if(this._descriptionFocusListener){this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}var v=o.byClass(this._root,"child_was_focused");if(v)i.removeClass(v,"child_was_focused");},cleanupSellInputs:function(){if(this._scraperListener){this._scraperListener.unsubscribe();this._scraperListener=null;}if(!this._descriptionFocusListener)this._descriptionFocusListener=m.listen(this._getDescriptionTextarea(),'focus',function(){n.logLaunchNormalComposer(this._config.targetID);this._descriptionFocusListener.remove();this._descriptionFocusListener=null;}.bind(this));},_inputsChanged:function(){var v=this.getComponent('forsale').instance,w=l.isEmpty(v.getTitleInput()),x=l.isEmpty(v.getHiddenPriceInput()),y=this.getComponent('maininput').instance,z=!y.getValue(),aa=this.getComponent('forsaleextras').instance,ba=l.isEmpty(aa.getPickupNoteInput());if(!this._inputsEverChanged.title&&!w){n.logComposerFillTitle(this._config.targetID,this._config.isEditComposer);this._inputsEverChanged.title=true;}if(!this._inputsEverChanged.price&&!x){n.logComposerFillPrice(this._config.targetID,this._config.isEditComposer);this._inputsEverChanged.price=true;}if(!this._inputsEverChanged.description&&!z){n.logComposerFillDescription(this._config.targetID,this._config.isEditComposer);this._inputsEverChanged.description=true;}if(!this._inputsEverChanged.pickupNote&&!ba){n.logComposerFillPickupNote(this._config.targetID,this._config.isEditComposer);this._inputsEverChanged.pickupNote=true;}var ca=!w&&!x,da=this.getSubmitButton().parentNode,ea=j.find(da,"._314l");i.conditionShow(ea,!ca);this._setSubmitButtonEnabled(ca);},_removeLinkAttachment:function(){if(!this._linkShare)return;j.remove(this._linkShare);this._linkShare=null;this._urlScraper.disable();},setHasPhotos:function(v){this._hasPhotos=v;if(v)this._removeLinkAttachment();},_getDescriptionTextarea:function(){return j.find(this.getComponent('maininput').element,'textarea.input');},_logLaunchSellComposer:function(){var v=o.byClass(this._root,"focus_target");if(i.hasClass(v,'child_was_focused')){n.logLaunchSellComposer(this._config.targetID,this._config.isEditComposer);g.inform('GroupSellComposer/launchedComposer');}else var w=this.getComponent('forsale').instance,x=m.listen(w.getTitleInput(),'focus',function(){x.remove();n.logLaunchSellComposer(this._config.targetID,this._config.isEditComposer);g.inform('GroupSellComposer/launchedComposer');}.bind(this));},_logComposerSubmitted:function(){var v=this.getComponent('forsale').instance,w=this.getComponent('maininput').instance,x=this.getComponent('forsaleextras').instance,y=parseFloat(l.getValue(v.getHiddenPriceInput()))*100;n.logComposerSubmit(this._config.targetID,l.getValue(v.getTitleInput()),l.getValue(v.getCurrencyInput()),y,w.getValue(),l.getValue(x.getPickupNoteInput()),this.getPhotoCount(),this._config.isEditComposer);}};e.exports=u;},null);
__d("ComposerXSellPlusAttachment",["ComposerXMediaUploadPlusAttachment","ComposerXSellAttachmentMixin","GroupSellLogger","Parent","classWithMixins","cx","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=k(g,m(h));for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(r,s,t,u,v,w){"use strict";n.call(this,r,s,t,u,v);this.attachmentClassName="_4_7-";this._linkShare=w;}q.prototype.initWithComponents=function(){"use strict";p.initWithComponents.call(this);this.getTagger().hideTaggerIcons();this._root.action=this._config.statusEndpoint;this.initSellInputs();};q.prototype.reset=function(){"use strict";this.resetSellInputs();p.reset.call(this);};q.prototype.cleanup=function(){"use strict";this.cleanupSellInputs();this.getTagger().showTaggerIcons();p.cleanup.call(this);};q.prototype.canSwitchAway=function(){"use strict";return !j.byClass(this._root,'async_saving');};q.prototype._onUploadStart=function(){"use strict";p._onUploadStart.call(this);this.setHasPhotos(true);};q.prototype._handleImageRemoved=function(r,s){"use strict";p._handleImageRemoved.call(this,r,s);this.updateEndpoints();i.logComposerDeletePhoto(this._config.targetID,this._isEdit);};q.prototype._handleImageAdded=function(r,s){"use strict";p._handleImageAdded.call(this,r,s);this.updateEndpoints();};q.prototype.updateEndpoints=function(){"use strict";if(this._photoCount>0){this._root.action=this._config.photoEndpoint;this.setHasPhotos(true);}else{this._root.action=this._config.statusEndpoint;this.setHasPhotos(false);}};q.prototype.getPhotoCount=function(){"use strict";return this._photoCount;};e.exports=q;},null);
__d("ComposerXCameraIconBehavior",["Arbiter","ComposerXMediaUploadHandler","CSS","Event","cx"],function(a,b,c,d,e,f,g,h,i,j,k){var l={initCameraIcon:function(m){this._cameraIcon=m.getComponent('cameraicon');if(!this._config.showCameraIcon){i.hide(this._cameraIcon.element);return;}i.show(this._cameraIcon.element);var n=this._cameraIcon.instance,o=new h(this._config.composerID,{imagesOnly:this._config.imagesOnly,isEditComposer:this._config.isEditComposer,photoUploadOverrideEndpoint:this._config.photoUploadOverrideEndpoint});this._listeners.push(j.listen(this._cameraIcon.element,'click',function(){o.fetchAttachments();g.inform('cameraicon/click');}.bind(this)));this._subscriptions.push(n.subscribe('change',function(){o.handleFileSelected(n);i.addClass(this._cameraIcon.element,"_19_a");}.bind(this)));}};e.exports=l;},null);
__d("ComposerXPlusTagger",["ComposerXCameraIconBehavior","ComposerXStandardTagger","classWithMixins","mixin"],function(a,b,c,d,e,f,g,h,i,j){var k=i(h,j(g));for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o){"use strict";k.call(this,o);this._eventuallyTagger=null;}n.prototype.init=function(o){"use strict";m.init.call(this,o);if(o.getComponent('cameraicon'))this.initCameraIcon(o);};n.prototype._nonObstrusiveSwitchToTagger=function(o){"use strict";var p=this._onTaggerShowCallbacks[o];delete this._onTaggerShowCallbacks[o];this.switchToTagger(o);this._dontHideTaggerOnMentionsFocus=o;this._onTaggerShowCallbacks[o]=p;};n.prototype.eventuallySwitchToTagger=function(o){"use strict";if(!this.isAnyTaggerShown()){this._nonObstrusiveSwitchToTagger(o);}else if(this._currentTagger!==o)this._eventuallyTagger=o;};n.prototype.switchToTagger=function(o){"use strict";if(this._eventuallyTagger===o)this._eventuallyTagger=null;this._nonEventuallyHideTaggers();this._showTagger(o);};n.prototype.hideTaggers=function(){"use strict";m.hideTaggers.call(this);if(this._eventuallyTagger){this._nonObstrusiveSwitchToTagger(this._eventuallyTagger);this._eventuallyTagger=null;}};n.prototype._nonEventuallyHideTaggers=function(){"use strict";m.hideTaggers.call(this);};n.prototype._hideTaggersFromMentionsInputClick=function(){"use strict";if(this._currentTagger!=this._dontHideTaggerOnMentionsFocus){this.eventuallySwitchToTagger(this._dontHideTaggerOnMentionsFocus);m._hideTaggersFromMentionsInputClick.call(this);}};e.exports=n;},null);
__d("ComposerXPlusTaggerWithOG",["ComposerXOGTaggerBehavior","ComposerXPlusTagger","classWithMixins","mixin"],function(a,b,c,d,e,f,g,h,i,j){var k=i(h,j(g));for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(){"use strict";if(k!==null)k.apply(this,arguments);}n.prototype.init=function(o){"use strict";m.init.call(this,o);this.initOGTagger(o);};n.prototype.cleanup=function(){"use strict";m.cleanup.call(this);this.cleanupOGTagger();};e.exports=n;},null);
__d("ComposerXInstanceResetter",[],function(a,b,c,d,e,f){function g(h){h.instance.reset();}e.exports=g;},null);
__d("ComposerXOGTaggerReset",["CSS"],function(a,b,c,d,e,f,g){function h(i){i.instance.reset();g.hide(i.element);}e.exports=h;},null);
__d("ComposerXPeopleTaggerReset",["CSS"],function(a,b,c,d,e,f,g){function h(i){i.instance.reset();g.hide(i.element);}e.exports=h;},null);
__d("ComposerXPlaceTaggerReset",["CSS"],function(a,b,c,d,e,f,g){function h(i){i.instance.getCore().reset();g.hide(i.element);}e.exports=h;},null);
__d("ComposerXForSaleComponent",["AdsCurrency","CSS","DOM","Event","Input","SubscriptionsHandler","getActiveElement","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q,r){"use strict";this._inputs=p;this._charCounts=q;this._options=r;this._currency=r.currencies[0];n(this._currency);this._currencySymbol=g.getSymbol(this._currency);n(this._currencySymbol);var s=this._inputs.title,t=this._inputs.price;this._subscriptions=new l();this._subscriptions.addSubscriptions(j.listen(s,'input',this._titleChanged.bind(this)),j.listen(s,'change',this._titleChanged.bind(this)),j.listen(s,'focus',this._titleFocusChanged.bind(this)),j.listen(s,'blur',this._titleFocusChanged.bind(this)),j.listen(t,'focus',this._priceFocused.bind(this)),j.listen(t,'input',this._priceChanged.bind(this)),j.listen(t,'change',this._priceChanged.bind(this)),j.listen(t,'blur',this._priceBlurred.bind(this)));k.setValue(this._inputs.hiddenCurrency,this._currency);this._priceChanged();this._priceBlurred();this._titleChanged();this._titleFocusChanged();}o.prototype._titleChanged=function(){"use strict";this._charCounts.title.innerText=this._options.inputMaxChars-k.getValue(this._inputs.title).length;};o.prototype._titleFocusChanged=function(){"use strict";h.conditionShow(this._charCounts.title,m()===this._inputs.title);};o.prototype._priceFocused=function(){"use strict";if(k.isEmpty(this._inputs.price))k.setValue(this._inputs.price,this._currencySymbol);};o.prototype._priceChanged=function(){"use strict";var p=this._getPriceParts(),q=p.dollars,r=p.hasDecimal,s=p.cents,t=p.input,u=q;if(r){u+='.';if(s!=null)u+=s;}var v=this._currencySymbol+u;if(v!==t)k.setValue(this._inputs.price,v);k.setValue(this._inputs.hiddenPrice,u);};o.prototype._priceBlurred=function(){"use strict";var p=this._getPriceParts(),q=p.dollars,r=p.hasDecimal,s=p.cents,t=p.input;if(q===''){k.reset(this._inputs.price);}else if(r&&!s){k.setValue(this._inputs.price,this._currencySymbol+q);}else if(s&&s.length===1)k.setValue(this._inputs.price,t+'0');};o.prototype._getPriceParts=function(){"use strict";var p=k.getValue(this._inputs.price),q=p.split('.'),r=q[0],s=q[1];r=r.replace(/\D/g,'');if(r)r=parseInt(r,10).toString();var t=s!=null;if(t&&!r)r='0';if(s){s=s.replace(/\D/g,'');s=s.substr(0,2);}return {dollars:r,hasDecimal:t,cents:s,input:p};};o.prototype.reset=function(){"use strict";k.reset(this._inputs.title);k.reset(this._inputs.price);k.reset(this._inputs.hiddenPrice);this._charCounts.title.innerText=this._options.inputMaxChars;};o.prototype.getTitleInput=function(){"use strict";return this._inputs.title;};o.prototype.getPriceInput=function(){"use strict";return this._inputs.price;};o.prototype.getCurrencyInput=function(){"use strict";return this._inputs.hiddenCurrency;};o.prototype.getHiddenPriceInput=function(){"use strict";return this._inputs.hiddenPrice;};e.exports=o;},null);
__d("ComposerXForSaleExtrasComponent",["CSS","Event","Input","SubscriptionsHandler","getActiveElement"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){"use strict";this._inputs=m;this._charCounts=n;this._options=o;var p=this._inputs.pickupNote;this._subscriptions=new j();this._subscriptions.addSubscriptions(h.listen(p,'input',this._pickupNoteChanged.bind(this)),h.listen(p,'change',this._pickupNoteChanged.bind(this)),h.listen(p,'focus',this._pickupNoteFocusChanged.bind(this)),h.listen(p,'blur',this._pickupNoteFocusChanged.bind(this)));this._pickupNoteChanged();this._pickupNoteFocusChanged();}l.prototype._pickupNoteChanged=function(){"use strict";var m=this._inputs.pickupNote;this._charCounts.pickupNote.innerText=this._options.inputMaxChars-i.getValue(m).length;};l.prototype._pickupNoteFocusChanged=function(){"use strict";g.conditionShow(this._charCounts.pickupNote,k()===this._inputs.pickupNote);};l.prototype.reset=function(){"use strict";i.reset(this._inputs.pickupNote);this._charCounts.pickupNote.innerText=this._options.inputMaxChars;};l.prototype.getPickupNoteInput=function(){"use strict";return this._inputs.pickupNote;};e.exports=l;},null);
__d("Network",["mixInEventEmitter"],function(a,b,c,d,e,f,g){var h=true,i=a.navigator.connection,j={0:'unknown',1:'ethernet',2:'wifi',3:'2g',4:'3g'};function k(){return h;}function l(q){if(q==h)return;h=q;p.emit(q?'online':'offline');}function m(){return i?i.bandwidth:(h?Infinity:0);}function n(){return i?i.metered:false;}function o(){var q=i?String(i.type):'0';return j[q]||q;}var p={getBandwidth:m,getType:o,isMetered:n,isOnline:k,setOnline:l};g(p,{online:true,offline:true});if(a.addEventListener){a.addEventListener('online',l.bind(null,true));a.addEventListener('offline',l.bind(null,false));}else if(a.attachEvent){a.attachEvent('online',l.bind(null,true));a.attachEvent('offline',l.bind(null,false));}e.exports=p;},null);
__d("ComposerPhotoSorter",["Arbiter","CSS","DOM","Rect","SortableGroup","arrayContains"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={init:function(n){this._container=n;this._reset();var o=this._update.bind(this);g.subscribe('multi-upload/images-added/'+n.id,o);g.subscribe('multi-upload/image-removed/'+n.id,o);},_reset:function(){this._ids=[];this._sortableGroup=new k();h.removeClass(this._container,'fbVaultPhotoSorter');},_update:function(){var n=i.scry(this._container,'.fbVaultGridItem').filter(function(o){return !h.hasClass(o,'fbVaultEditableGridMoreLink');});if(n.length<2){if(this._ids.length>1){this._sortableGroup.destroy();this._reset();}return;}h.addClass(this._container,'fbVaultPhotoSorter');n.forEach(function(o){var p=i.scry(o,'input[type="hidden"]')[0];if(p&&!l(this._ids,p.value)){this._ids.push(p.value);this._sortableGroup.addSortable(p.value,o);}}.bind(this));this._sortableGroup.setBoundingBox(new j(this._container));}};e.exports=m;},null);
__d("VaultGridUploadItem",[],function(a,b,c,d,e,f){function g(h){"use strict";this.$VaultGridUploadItem0=h;}g.prototype.getUploadInput=function(){"use strict";return this.$VaultGridUploadItem0;};e.exports=g;},null);
__d("VideoUploadFileValidator",["ErrorDialog","JSXDOM","fbt"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this.$VideoUploadFileValidator0=k;}j.prototype.validate=function(k,l){"use strict";return this.$VideoUploadFileValidator1(k)&&this.$VideoUploadFileValidator2(k)&&this.$VideoUploadFileValidator3(l);};j.prototype.$VideoUploadFileValidator1=function(k){"use strict";if(!this.$VideoUploadFileValidator0.extensions[k.getExtension()]){var l="http://www.facebook.com/help/"+"?faq=218673814818907#What-formats-of-video-files-can-I-upload?",m=h.a({href:l},"recommended formats");g.show("Unsupported File Format",i._("Sorry, the file you selected is in a format that we don't support. Please use one of our {link} for video files.",[i.param("link",m)]));return false;}return true;};j.prototype.$VideoUploadFileValidator2=function(k){"use strict";if(k.getSize()===null)return true;if(k.getSize()<this.$VideoUploadFileValidator0.minSize){var l=h.strong(null,i._("{kilobytes} KB",[i.param("kilobytes",Math.round(this.$VideoUploadFileValidator4/1024))]));g.show("Video File Too Small",i._("The video file you tried to upload is too small. The minimum size for a video file is {min-size}. Please try again with a larger file.",[i.param("min-size",l)]));return false;}if(k.getSize()>this.$VideoUploadFileValidator0.maxSize){var m=h.strong(null,i._("{max-size} MB",[i.param("max-size",Math.round(this.$VideoUploadFileValidator0.maxSize/1024/1024))]));g.show("Video File Too Large",i._("The video file you tried to upload is too large. The maximum size for a video file is {max-size}. Please try again with a smaller file.",[i.param("max-size",m)]));return false;}return true;};j.prototype.$VideoUploadFileValidator3=function(k){"use strict";if(!k)return true;var l=k.format.duration;if(l>this.$VideoUploadFileValidator0.maxLength){g.show("Video Duration Too Long",i._("The duration of the video you tried to upload is too long. The maximum duration for a video is {max-length} minutes. Please upload a shorter video.",[i.param("max-length",Math.round(this.$VideoUploadFileValidator0.maxLength/60))]));return false;}if(l<this.$VideoUploadFileValidator0.minLength){g.show("Video File Too Short",i._("The duration of the video you tried to upload is too short. The minimum length for a video is {min-length} minutes. Please upload a longer video.",[i.param("min-length",Math.round(this.$VideoUploadFileValidator0.minLength/60))]));return false;}if(!k.streams.primaryVideo&&k.streams.primaryAudio){var m="http://www.facebook.com/help/"+"?faq=218673814818907#What-formats-of-video-files-can-I-upload?",n=h.a({href:m},"supported video format");g.show("No Video Detected",i._("It looks like you're trying to upload a file that isn't a video. Please try uploading a {supported-video-format link}",[i.param("supported-video-format link",n)]));return false;}if(k.streams.primaryVideo.width<this.$VideoUploadFileValidator0.minWidth){g.show("Video Width Too Narrow",i._("The width of the video you tried to upload is too short. The minimum width for a video is {min-width}. Please upload a wider video.",[i.param("min-width",this.$VideoUploadFileValidator0.minWidth)]));return false;}if(k.streams.primaryVideo.height<this.$VideoUploadFileValidator0.minHeight){g.show("Video Height Too Short",i._("The height of the video you tried to upload is too short. The minimum height for a video is {min-height}. Please upload a taller video.",[i.param("min-height",this.$VideoUploadFileValidator0.minHeight)]));return false;}return true;};e.exports=j;},null);
__d("VideoUploadProgressBar",["CSS","VideoUploadFeatureDetector","cx"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this.$VideoUploadProgressBar0=k.progress_bar;this.$VideoUploadProgressBar1=k.throbber;this.$VideoUploadProgressBar2=k.uploader;this.$VideoUploadProgressBar3=k.start_margin;this.$VideoUploadProgressBar4=k.start_delay;this.$VideoUploadProgressBar5=k.end_margin;this.$VideoUploadProgressBar6=k.end_delay;this.$VideoUploadProgressBar7();}j.prototype.reset=function(){"use strict";this.$VideoUploadProgressBar0.setPosition(0);};j.computeProgress=function(k,l,m,n,o){"use strict";var p=Math.min(k+l,m);return (p)/m*(100-n-o)+n;};j.prototype.$VideoUploadProgressBar7=function(){"use strict";if(h.supportsFileAPI()){this.$VideoUploadProgressBar2.subscribe('upload-requested',this.$VideoUploadProgressBar8.bind(this));this.$VideoUploadProgressBar2.subscribe('upload-progressed',this.$VideoUploadProgressBar9.bind(this));this.$VideoUploadProgressBar2.subscribe('online',this.$VideoUploadProgressBara.bind(this));this.$VideoUploadProgressBar2.subscribe('offline',this.$VideoUploadProgressBarb.bind(this));}else this.$VideoUploadProgressBar2.subscribe('upload-requested',this.$VideoUploadProgressBarc.bind(this));};j.prototype.$VideoUploadProgressBar8=function(event){"use strict";g.show(this.$VideoUploadProgressBar0.getRoot());g.removeClass(this.$VideoUploadProgressBar0.getRoot(),"_5r5a");this.$VideoUploadProgressBar0.setTarget(this.$VideoUploadProgressBar3,this.$VideoUploadProgressBar4);};j.prototype.$VideoUploadProgressBar9=function(event,k){"use strict";g.removeClass(this.$VideoUploadProgressBar0.getRoot(),"_5r5a");var l=j.computeProgress(k.start_offset,k.sent_bytes,k.file_size,this.$VideoUploadProgressBar3,this.$VideoUploadProgressBar5);this.$VideoUploadProgressBar0.setPosition(l);if(l>=100-this.$VideoUploadProgressBar5)this.$VideoUploadProgressBar0.setTarget(100,this.$VideoUploadProgressBar6);};j.prototype.$VideoUploadProgressBara=function(event){"use strict";g.removeClass(this.$VideoUploadProgressBar0.getRoot(),"_5r5a");};j.prototype.$VideoUploadProgressBarb=function(event){"use strict";g.addClass(this.$VideoUploadProgressBar0.getRoot(),"_5r5a");};j.prototype.$VideoUploadProgressBarc=function(event){"use strict";g.show(this.$VideoUploadProgressBar1);};e.exports=j;},null);
__d("VideoUploadRequest",["AsyncRequest","DOM","DTSG","FileForm","Form","VideoUploadFeatureDetector","copyProperties","emptyFunction","submitForm"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p='video';function q(r){"use strict";this.$VideoUploadRequest0=r;this.$VideoUploadRequest1=null;this.$VideoUploadRequest2=false;this.$VideoUploadRequest3=null;this.$VideoUploadRequest4=null;this.$VideoUploadRequest5=n;this.$VideoUploadRequest6=n;this.$VideoUploadRequest7=n;this.$VideoUploadRequest8=n;}q.prototype.setAllowCrossOrigin=function(r){"use strict";this.$VideoUploadRequest2=r;return this;};q.prototype.setData=function(r){"use strict";this.$VideoUploadRequest3=r;return this;};q.prototype.setWaterfallID=function(r){"use strict";this.$VideoUploadRequest4=r;return this;};q.prototype.setSuccessHandler=function(r){"use strict";this.$VideoUploadRequest5=r;return this;};q.prototype.setErrorHandler=function(r){"use strict";this.$VideoUploadRequest6=r;return this;};q.prototype.setTransportErrorHandler=function(r){"use strict";this.$VideoUploadRequest7=r;return this;};q.prototype.setUploadProgressHandler=function(r){"use strict";this.$VideoUploadRequest8=r;return this;};q.prototype.send=function(){"use strict";if(this.$VideoUploadRequest1)throw new Error('An upload request is already in progress.');if(l.supportsXHR()){this.$VideoUploadRequest1=this.$VideoUploadRequest9();this.$VideoUploadRequest1.send();}else{this.$VideoUploadRequest1=this.$VideoUploadRequesta();this.$VideoUploadRequestb(this.$VideoUploadRequest1);}};q.prototype.sendChunk=function(r){"use strict";if(this.$VideoUploadRequest1)throw new Error('An upload request is already in progress.');var s=new FormData();s.append('video_file_chunk',r);this.$VideoUploadRequest1=this.$VideoUploadRequest9();this.$VideoUploadRequest1.setRawData(s);this.$VideoUploadRequest1.send();};q.prototype.sendFile=function(r){"use strict";if(this.$VideoUploadRequest1)throw new Error('An upload request is already in progress.');this.$VideoUploadRequest1=this.$VideoUploadRequesta();var s=r.cloneNode(false);r.name=p;h.replace(r,s);h.appendContent(this.$VideoUploadRequest1.getRoot(),r);this.$VideoUploadRequestb(this.$VideoUploadRequest1);r.name=s.name;h.replace(s,r);};q.prototype.abort=function(){"use strict";if(!this.$VideoUploadRequest1)throw new Error('There is no upload request in progress.');this.$VideoUploadRequest1.abort();this.$VideoUploadRequest1=null;};q.prototype.$VideoUploadRequest9=function(){"use strict";return this.__getAsyncRequest().setAllowCrossOrigin(this.$VideoUploadRequest2).setURI(this.$VideoUploadRequest0).setData(this.$VideoUploadRequest3).setRequestHeader('X_FB_VIDEO_WATERFALL_ID',this.$VideoUploadRequest4).setHandler(this.$VideoUploadRequest5).setErrorHandler(this.$VideoUploadRequest6).setTransportErrorHandler(this.$VideoUploadRequest7).setUploadProgressHandler(this.$VideoUploadRequest8);};q.prototype.__getAsyncRequest=function(){"use strict";return new g();};q.prototype.$VideoUploadRequesta=function(){"use strict";var r=h.create('form',{action:this.$VideoUploadRequest0,method:'POST'});k.createHiddenInputs(m({fb_dtsg:i.getToken()},this.$VideoUploadRequest3),r);var s=new j(r,null,{allowCrossOrigin:this.$VideoUploadRequest2});s.subscribe('success',this.$VideoUploadRequestc.bind(this));s.subscribe('failure',this.$VideoUploadRequestd.bind(this));s.subscribe('progress',this.$VideoUploadRequeste.bind(this));return s;};q.prototype.$VideoUploadRequestb=function(r){"use strict";h.appendContent(document.body,r.getRoot());o(r.getRoot());};q.prototype.$VideoUploadRequestc=function(event,r){"use strict";this.$VideoUploadRequest5(r.response);};q.prototype.$VideoUploadRequestd=function(event,r){"use strict";this.$VideoUploadRequest6(r.response);};q.prototype.$VideoUploadRequeste=function(event,r){"use strict";this.$VideoUploadRequest8(r.event);};e.exports=q;},null);
__d("VideoUploadRequestContext",[],function(a,b,c,d,e,f){function g(){"use strict";this.reset();}g.prototype.setFile=function(h){"use strict";this.$VideoUploadRequestContext0=h;return this;};g.prototype.getFile=function(){"use strict";return this.$VideoUploadRequestContext0;};g.prototype.setMetadata=function(h){"use strict";this.$VideoUploadRequestContext1=h;return this;};g.prototype.getMetadata=function(){"use strict";return this.$VideoUploadRequestContext1;};g.prototype.setVideoID=function(h){"use strict";this.$VideoUploadRequestContext2=h;return this;};g.prototype.getVideoID=function(){"use strict";return this.$VideoUploadRequestContext2;};g.prototype.setStartOffset=function(h){"use strict";this.$VideoUploadRequestContext3=h;return this;};g.prototype.getStartOffset=function(){"use strict";return this.$VideoUploadRequestContext3;};g.prototype.setEndOffset=function(h){"use strict";this.$VideoUploadRequestContext4=h;return this;};g.prototype.getEndOffset=function(){"use strict";return this.$VideoUploadRequestContext4;};g.prototype.setTargetID=function(h){"use strict";this.$VideoUploadRequestContext5=h;return this;};g.prototype.getTargetID=function(){"use strict";return this.$VideoUploadRequestContext5;};g.prototype.setSource=function(h){"use strict";this.$VideoUploadRequestContext6=h;return this;};g.prototype.getSource=function(){"use strict";return this.$VideoUploadRequestContext6;};g.prototype.setWaterfallID=function(h){"use strict";this.$VideoUploadRequestContext7=h;return this;};g.prototype.getWaterfallID=function(){"use strict";return this.$VideoUploadRequestContext7;};g.prototype.setSupportsChunking=function(h){"use strict";this.$VideoUploadRequestContext8=h;return this;};g.prototype.getSupportsChunking=function(){"use strict";return this.$VideoUploadRequestContext8;};g.prototype.setSupportsFileAPI=function(h){"use strict";this.$VideoUploadRequestContext9=h;return this;};g.prototype.getSupportsFileAPI=function(){"use strict";return this.$VideoUploadRequestContext9;};g.prototype.reset=function(){"use strict";this.$VideoUploadRequestContext0=null;this.$VideoUploadRequestContext2=null;this.$VideoUploadRequestContext3=null;this.$VideoUploadRequestContext4=null;this.$VideoUploadRequestContext5=null;this.$VideoUploadRequestContext6=null;this.$VideoUploadRequestContext7=null;this.$VideoUploadRequestContext8=null;this.$VideoUploadRequestContext9=null;};e.exports=g;},null);
__d("VideoUploadPostRequestManager",["ArbiterMixin","VideoUploadRequest","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j){var k=j(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o){"use strict";this.$VideoUploadPostRequestManager0=o;}n.prototype.getRequest=function(){"use strict";return this.$VideoUploadPostRequestManager1;};n.prototype.sendRequest=function(o){"use strict";if(this.$VideoUploadPostRequestManager1)return;var p=i(o.getMetadata(),this.__createRequestData(o));this.$VideoUploadPostRequestManager1=this.__getVideoUploadRequest(this.$VideoUploadPostRequestManager0).setAllowCrossOrigin(true).setData(p).setWaterfallID(o.getWaterfallID()).setSuccessHandler(this.$VideoUploadPostRequestManager2.bind(this)).setErrorHandler(this.$VideoUploadPostRequestManager3.bind(this)).setTransportErrorHandler(this.$VideoUploadPostRequestManager3.bind(this));this.$VideoUploadPostRequestManager1.send();this.inform('request-started');};n.prototype.__createRequestData=function(o){"use strict";return {video_id:o.getVideoID(),target_id:o.getTargetID(),source:o.getSource(),waterfall_id:o.getWaterfallID(),supports_chunking:o.getSupportsChunking()};};n.prototype.__getVideoUploadRequest=function(o){"use strict";return new h(o);};n.prototype.clearRequest=function(){"use strict";this.$VideoUploadPostRequestManager1=null;};n.prototype.isInProgress=function(){"use strict";return !!this.$VideoUploadPostRequestManager1;};n.prototype.$VideoUploadPostRequestManager2=function(o){"use strict";this.inform('request-finished',{video_id:o.getPayload().video_id});this.clearRequest();};n.prototype.$VideoUploadPostRequestManager3=function(o){"use strict";this.inform('request-failed',{error_code:o.getError(),error_description:o.getErrorDescription(),error_summary:o.getErrorSummary()});this.clearRequest();};e.exports=n;},null);
__d("VideoUploadConnectionMonitor",["ArbiterMixin","Network","VideoUploadFeatureDetector","debounce","mixin"],function(a,b,c,d,e,f,g,h,i,j,k){var l=k(g);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(){"use strict";this.$VideoUploadConnectionMonitor0=false;this.$VideoUploadConnectionMonitor1=[];this.$VideoUploadConnectionMonitor2=false;this.$VideoUploadConnectionMonitor3=true;this.$VideoUploadConnectionMonitor4=j(function(){this.$VideoUploadConnectionMonitor5(false);}.bind(this),2000);}o.prototype.notifyStart=function(){"use strict";if(this.$VideoUploadConnectionMonitor2)return;if(this.$VideoUploadConnectionMonitor1.length===0){this.$VideoUploadConnectionMonitor1.push(h.addListener('online',function(){this.$VideoUploadConnectionMonitor5(true);}.bind(this)));this.$VideoUploadConnectionMonitor1.push(h.addListener('offline',function(){if(this.$VideoUploadConnectionMonitor0){this.$VideoUploadConnectionMonitor4();}else{this.$VideoUploadConnectionMonitor4.reset();setTimeout(this.$VideoUploadConnectionMonitor4,2000);}}.bind(this)));}this.$VideoUploadConnectionMonitor2=true;};o.prototype.notifyProgress=function(event){"use strict";if(!this.$VideoUploadConnectionMonitor2)return;if(!event)return;if(i.supportsFullProgress()){this.$VideoUploadConnectionMonitor0=true;if(event.total&&event.loaded===event.total){this.$VideoUploadConnectionMonitor4.reset();}else this.$VideoUploadConnectionMonitor4();}};o.prototype.notifySuccess=function(){"use strict";if(!this.$VideoUploadConnectionMonitor2)return;this.reset();this.$VideoUploadConnectionMonitor5(true);};o.prototype.notifyTransportError=function(){"use strict";if(!this.$VideoUploadConnectionMonitor2)return;this.$VideoUploadConnectionMonitor2=false;this.$VideoUploadConnectionMonitor5(false);};o.prototype.notifyError=function(){"use strict";if(!this.$VideoUploadConnectionMonitor2)return;this.reset();this.$VideoUploadConnectionMonitor5(true);};o.prototype.isOnline=function(){"use strict";return this.$VideoUploadConnectionMonitor3;};o.prototype.reset=function(){"use strict";while(this.$VideoUploadConnectionMonitor1.length)this.$VideoUploadConnectionMonitor1.pop().remove();this.$VideoUploadConnectionMonitor4.reset();this.$VideoUploadConnectionMonitor2=false;};o.prototype.$VideoUploadConnectionMonitor5=function(p){"use strict";this.$VideoUploadConnectionMonitor4.reset();if(this.$VideoUploadConnectionMonitor3!==p){this.$VideoUploadConnectionMonitor3=p;if(this.$VideoUploadConnectionMonitor3){this.inform('online');}else this.inform('offline');}};e.exports=o;},null);
__d("VideoUploadReceiveRequestManager",["ArbiterMixin","VideoUploadConnectionMonitor","VideoUploadRequest","mixin"],function(a,b,c,d,e,f,g,h,i,j){var k=1363037,l=j(g);for(var m in l)if(l.hasOwnProperty(m))o[m]=l[m];var n=l===null?null:l.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=l;function o(p,q,r,s,t){"use strict";this.$VideoUploadReceiveRequestManager0=p;this.$VideoUploadReceiveRequestManager1=q;this.$VideoUploadReceiveRequestManager2=r;this.$VideoUploadReceiveRequestManager3=s;this.$VideoUploadReceiveRequestManager4=t;this.$VideoUploadReceiveRequestManager5=0;this.$VideoUploadReceiveRequestManager6=0;this.$VideoUploadReceiveRequestManager7=null;this.$VideoUploadReceiveRequestManager8=null;this.$VideoUploadReceiveRequestManager9=new h();this.$VideoUploadReceiveRequestManager9.subscribe('online',this.$VideoUploadReceiveRequestManagera.bind(this));this.$VideoUploadReceiveRequestManager9.subscribe('offline',this.$VideoUploadReceiveRequestManagerb.bind(this));}o.prototype.sendRequest=function(p){"use strict";if(this.$VideoUploadReceiveRequestManagerc)return;this.$VideoUploadReceiveRequestManagerd=p;this.$VideoUploadReceiveRequestManagere();};o.prototype.cancelRequest=function(){"use strict";if(!this.$VideoUploadReceiveRequestManagerc)return;this.$VideoUploadReceiveRequestManagerc.abort();this.$VideoUploadReceiveRequestManagerf();};o.prototype.$VideoUploadReceiveRequestManagerf=function(){"use strict";this.$VideoUploadReceiveRequestManagerc=null;this.$VideoUploadReceiveRequestManagerg=null;this.$VideoUploadReceiveRequestManager5=0;this.$VideoUploadReceiveRequestManager6=0;this.$VideoUploadReceiveRequestManager7=null;this.$VideoUploadReceiveRequestManager8=null;this.$VideoUploadReceiveRequestManagerd.reset();this.$VideoUploadReceiveRequestManager9.reset();clearTimeout(this.$VideoUploadReceiveRequestManagerh);this.$VideoUploadReceiveRequestManagerh=null;};o.prototype.$VideoUploadReceiveRequestManagere=function(){"use strict";clearTimeout(this.$VideoUploadReceiveRequestManagerh);this.$VideoUploadReceiveRequestManagerh=null;if(this.$VideoUploadReceiveRequestManagerd.getSupportsChunking()&&this.$VideoUploadReceiveRequestManagerd.getStartOffset()>=this.$VideoUploadReceiveRequestManagerd.getFile().getSize())return;this.$VideoUploadReceiveRequestManagerc=this.__getVideoUploadRequest(this.$VideoUploadReceiveRequestManager0).setAllowCrossOrigin(true).setData(this.__createRequestData(this.$VideoUploadReceiveRequestManagerd)).setWaterfallID(this.$VideoUploadReceiveRequestManagerd.getWaterfallID()).setSuccessHandler(this.__handleSuccessResponse.bind(this)).setErrorHandler(this.__handleServerFailureResponse.bind(this)).setTransportErrorHandler(this.$VideoUploadReceiveRequestManageri.bind(this)).setUploadProgressHandler(this.$VideoUploadReceiveRequestManagerj.bind(this));this.$VideoUploadReceiveRequestManager7=Date.now();if(this.$VideoUploadReceiveRequestManagerd.getSupportsChunking()){this.$VideoUploadReceiveRequestManagerc.sendChunk(this.$VideoUploadReceiveRequestManagerk());}else this.$VideoUploadReceiveRequestManagerc.sendFile(this.$VideoUploadReceiveRequestManagerd.getFile().getFileInput());this.$VideoUploadReceiveRequestManager9.notifyStart();this.inform('request-started',{start_offset:this.$VideoUploadReceiveRequestManagerd.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManagerd.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager5,server_retries:this.$VideoUploadReceiveRequestManager6,upload_speed:this.$VideoUploadReceiveRequestManager8});};o.prototype.__getVideoUploadRequest=function(p){"use strict";return new i(p);};o.prototype.$VideoUploadReceiveRequestManagerl=function(p){"use strict";clearTimeout(this.$VideoUploadReceiveRequestManagerh);this.$VideoUploadReceiveRequestManagerh=setTimeout(this.$VideoUploadReceiveRequestManagere.bind(this),p);};o.prototype.$VideoUploadReceiveRequestManagerk=function(){"use strict";if(this.$VideoUploadReceiveRequestManagerg)return this.$VideoUploadReceiveRequestManagerg;this.$VideoUploadReceiveRequestManagerg=this.$VideoUploadReceiveRequestManagerd.getFile().getChunk(this.$VideoUploadReceiveRequestManagerd.getStartOffset(),this.$VideoUploadReceiveRequestManagerd.getEndOffset());return this.$VideoUploadReceiveRequestManagerg;};o.prototype.__createRequestData=function(p){"use strict";return {video_id:p.getVideoID(),start_offset:p.getStartOffset(),source:p.getSource(),target_id:p.getTargetID(),waterfall_id:p.getWaterfallID(),supports_chunking:p.getSupportsChunking(),upload_speed:this.$VideoUploadReceiveRequestManager8};};o.prototype.__handleSuccessResponse=function(p){"use strict";var q=Date.now()-this.$VideoUploadReceiveRequestManager7;q=(q===0)?1:q;var r=p.getPayload();if(r.start_offset===this.$VideoUploadReceiveRequestManagerd.getEndOffset()){var s=this.$VideoUploadReceiveRequestManagerd.getEndOffset()-this.$VideoUploadReceiveRequestManagerd.getStartOffset();this.$VideoUploadReceiveRequestManager8=Math.floor(s/q);}else this.$VideoUploadReceiveRequestManager8=null;this.$VideoUploadReceiveRequestManager9.notifySuccess();this.inform('request-finished',{start_offset:this.$VideoUploadReceiveRequestManagerd.getStartOffset(),end_offset:this.$VideoUploadReceiveRequestManagerd.getEndOffset(),transport_retries:this.$VideoUploadReceiveRequestManager5,server_retries:this.$VideoUploadReceiveRequestManager6,upload_speed:this.$VideoUploadReceiveRequestManager8});this.$VideoUploadReceiveRequestManagerd.setStartOffset(r.start_offset);this.$VideoUploadReceiveRequestManagerd.setEndOffset(r.end_offset);this.$VideoUploadReceiveRequestManagerc=null;this.$VideoUploadReceiveRequestManagerg=null;this.$VideoUploadReceiveRequestManager5=0;this.$VideoUploadReceiveRequestManager6=0;if(this.$VideoUploadReceiveRequestManagerd.getSupportsChunking())this.$VideoUploadReceiveRequestManagere();};o.prototype.__handleServerFailureResponse=function(p){"use strict";this.$VideoUploadReceiveRequestManagerc=null;this.$VideoUploadReceiveRequestManager5=0;this.$VideoUploadReceiveRequestManager8=null;this.$VideoUploadReceiveRequestManager9.notifyError();if(p.isTransient()&&++this.$VideoUploadReceiveRequestManager6<=this.$VideoUploadReceiveRequestManager2){this.$VideoUploadReceiveRequestManagerl(this.$VideoUploadReceiveRequestManagerm(this.$VideoUploadReceiveRequestManager4,this.$VideoUploadReceiveRequestManager6));}else if(this.__hasInvalidStartOffsetAndHasRetries(p.getError())){var q=p.getPayload();if(this.$VideoUploadReceiveRequestManagerd.getStartOffset()!=q.start_offset&&this.$VideoUploadReceiveRequestManagerd.getEndOffset()!=q.end_offset){this.$VideoUploadReceiveRequestManagerd.setStartOffset(q.start_offset);this.$VideoUploadReceiveRequestManagerd.setEndOffset(q.end_offset);this.$VideoUploadReceiveRequestManagerg=null;}this.$VideoUploadReceiveRequestManagere();}else this.$VideoUploadReceiveRequestManagern(p);};o.prototype.__hasInvalidStartOffsetAndHasRetries=function(p){"use strict";return p===k&&++this.$VideoUploadReceiveRequestManager6<=this.$VideoUploadReceiveRequestManager2;};o.prototype.$VideoUploadReceiveRequestManageri=function(p){"use strict";this.$VideoUploadReceiveRequestManager9.notifyTransportError();this.$VideoUploadReceiveRequestManager8=null;if(++this.$VideoUploadReceiveRequestManager5<=this.$VideoUploadReceiveRequestManager1){this.$VideoUploadReceiveRequestManagerc=null;this.$VideoUploadReceiveRequestManagerl(this.$VideoUploadReceiveRequestManagerm(this.$VideoUploadReceiveRequestManager3,this.$VideoUploadReceiveRequestManager5));}else this.$VideoUploadReceiveRequestManagern(p);};o.prototype.$VideoUploadReceiveRequestManagern=function(p){"use strict";this.inform('request-failed',{error_code:p.getError(),error_description:p.getErrorDescription(),error_summary:p.getErrorSummary()});this.$VideoUploadReceiveRequestManagerf();};o.prototype.$VideoUploadReceiveRequestManagerj=function(event){"use strict";this.$VideoUploadReceiveRequestManager9.notifyProgress(event);this.inform('request-progressed',{file_size:this.$VideoUploadReceiveRequestManagerd.getFile().getSize(),start_offset:this.$VideoUploadReceiveRequestManagerd.getStartOffset(),sent_bytes:event.loaded});};o.prototype.$VideoUploadReceiveRequestManagera=function(event){"use strict";this.inform('online');this.$VideoUploadReceiveRequestManager5=0;if(this.$VideoUploadReceiveRequestManagerh)this.$VideoUploadReceiveRequestManagere();};o.prototype.$VideoUploadReceiveRequestManagerb=function(event){"use strict";this.inform('offline');};o.prototype.$VideoUploadReceiveRequestManagerm=function(p,q){"use strict";return Math.pow(p,q)*1000;};e.exports=o;},null);
__d("VideoUploadStartRequestManager",["ArbiterMixin","VideoUploadRequest","mixin"],function(a,b,c,d,e,f,g,h,i){var j=i(g);for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(n){"use strict";this.$VideoUploadStartRequestManager0=n;}m.prototype.getRequest=function(){"use strict";return this.$VideoUploadStartRequestManager1;};m.prototype.sendRequest=function(n){"use strict";if(this.$VideoUploadStartRequestManager1)return;this.$VideoUploadStartRequestManager1=this.__getVideoUploadRequest(this.$VideoUploadStartRequestManager0).setAllowCrossOrigin(true).setData(this.__getDataToSend(n)).setWaterfallID(n.getWaterfallID()).setSuccessHandler(this.$VideoUploadStartRequestManager2.bind(this)).setErrorHandler(this.$VideoUploadStartRequestManager3.bind(this)).setTransportErrorHandler(this.$VideoUploadStartRequestManager3.bind(this));this.$VideoUploadStartRequestManager1.send();this.inform('request-started');};m.prototype.__getVideoUploadRequest=function(n){"use strict";return new h(n);};m.prototype.__getDataToSend=function(n){"use strict";return {file_size:n.getFile().getSize(),file_extension:n.getFile().getExtension(),target_id:n.getTargetID(),source:n.getSource(),waterfall_id:n.getWaterfallID(),supports_chunking:n.getSupportsChunking(),supports_file_api:n.getSupportsFileAPI()};};m.prototype.cancelRequest=function(){"use strict";if(!this.$VideoUploadStartRequestManager1)return;this.$VideoUploadStartRequestManager1.abort();this.$VideoUploadStartRequestManager1=null;};m.prototype.$VideoUploadStartRequestManager2=function(n){"use strict";var o=n.getPayload();this.inform('request-finished',this.__getSuccessInformData(o));this.$VideoUploadStartRequestManager1=null;};m.prototype.__getSuccessInformData=function(n){"use strict";return {video_id:n.video_id,start_offset:n.start_offset,end_offset:n.end_offset};};m.prototype.$VideoUploadStartRequestManager3=function(n){"use strict";this.inform('request-failed',this.__getFailureInformData(n));this.$VideoUploadStartRequestManager1=null;};m.prototype.__getFailureInformData=function(n){"use strict";return {error_code:n.getError(),error_description:n.getErrorDescription(),error_summary:n.getErrorSummary()};};e.exports=m;},null);
__d("VideoUploadMetadataParser",["VideoUploadFeatureDetector","fileSlice"],function(a,b,c,d,e,f,g,h){var i=4,j=4,k=5242880,l=24,m=88,n=20,o=16,p=4,q=84;function r(s,t){"use strict";this.$VideoUploadMetadataParser0=s;this.$VideoUploadMetadataParser1=t;}r.prototype.getHandler=function(){"use strict";return this.$VideoUploadMetadataParser1;};r.prototype.parse=function(){"use strict";if(!g.supportsFileReading()){this.$VideoUploadMetadataParser1(null);return;}switch(this.$VideoUploadMetadataParser0.getExtension()){case 'mp4':case 'mov':case 'm4v':case '3gp':case '3g2':break;default:this.$VideoUploadMetadataParser1(null);return;}this.$VideoUploadMetadataParser2(0,Math.min(k,this.$VideoUploadMetadataParser0.getSize()),null);};r.prototype.$VideoUploadMetadataParser2=function(s,t,u){"use strict";var v=new FileReader();v.onload=(function(event){try{var y=this.$VideoUploadMetadataParser3(new DataView(v.result),0,t-s,s,u);if(y.completed){y=this.$VideoUploadMetadataParser4(y);this.$VideoUploadMetadataParser1(y);}else this.$VideoUploadMetadataParser2(s+y.nextOffset,Math.min(this.$VideoUploadMetadataParser0.getSize(),s+y.nextOffset+k),y);}catch(x){this.$VideoUploadMetadataParser1(null);}}.bind(this));var w=this.$VideoUploadMetadataParser0.getFile();v.readAsArrayBuffer(h.call(w,s,t));};r.prototype.$VideoUploadMetadataParser5=function(s,t,u){"use strict";var v=[];for(var w=0;w<u;w++)v.push(String.fromCharCode(s.getUint8(t+w)));return v.join('');};r.prototype.$VideoUploadMetadataParser3=function(s,t,u,v,w){"use strict";if(!w)w={widths:[],heights:[],streamTypes:[],streamDurations:[]};while(t<u){var x=s.getUint32(t),y=this.$VideoUploadMetadataParser5(s,t+i,j);if(t+x>u){w.completed=false;w.nextOffset=t;if(x>u)w.nextOffset+=x;return w;}if(t+v===0&&y!=='ftyp')throw new Error('No ftyp atom');if(x===0)throw new Error('len is 0');var z=function(){var da=s.getUint32(t+n),ea=s.getUint32(t+l);return ea/da;};switch(y){case 'moov':case 'trak':case 'mdia':t+=i+j;break;case 'mvhd':w.duration=z();t+=x;break;case 'tkhd':var aa=s.getUint16(t+q),ba=s.getUint16(t+m);w.widths.push(aa);w.heights.push(ba);t+=x;break;case 'hdlr':var ca=this.$VideoUploadMetadataParser5(s,t+o,p);switch(ca){case 'vide':ca='video';break;case 'soun':ca='audio';break;case 'subt':ca='subtitle';break;default:ca='data';}w.streamTypes.push(ca);t+=x;break;case 'mdhd':w.streamDurations.push(z());t+=x;break;default:t+=x;}}w.completed=true;return w;};r.prototype.$VideoUploadMetadataParser4=function(s){"use strict";var t={streams:{},format:{}},u=s.widths.length,v=s.heights.length,w=s.streamTypes.length,x=s.streamDurations.length;if(u!==v||u!==w||u!==x)return null;for(var y=0;y<u;y++){var z={width:s.widths[y],height:s.heights[y],duration:s.streamDurations[y],type:s.streamTypes[y]};if(z.type==='video'){var aa=z.width*z.height,ba=t.streams.primaryVideo;if(!ba||(ba.width*ba.height)>aa)t.streams.primaryVideo=z;}else if(z.type==='audio'){var ca=t.streams.primaryAudio;if(!ca||ca.duration<z.duration)t.streams.primaryAudio=z;}}t.format.duration=s.duration;return t;};e.exports=r;},null);
__d("VideoUploadSession",["ArbiterMixin","AsyncRequest","VideoUploadFeatureDetector","VideoUploadFile","VideoUploadFileValidator","VideoUploadLogger","VideoUploadMetadataParser","VideoUploadPostRequestManager","VideoUploadReceiveRequestManager","VideoUploadRequestContext","VideoUploadStartRequestManager","WaterfallIDGenerator","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=s(g);for(var u in t)if(t.hasOwnProperty(u))w[u]=t[u];var v=t===null?null:t.prototype;w.prototype=Object.create(v);w.prototype.constructor=w;w.__superConstructor__=t;function w(x){"use strict";this.$VideoUploadSession0=x.source;this.$VideoUploadSession1=x.target_id;this.$VideoUploadSession2=x.logging_delay;this.$VideoUploadSession3=new k({minSize:x.min_size,maxSize:x.max_size,minLength:x.min_length,maxLength:x.max_length,minWidth:x.min_width,minHeight:x.min_height,extensions:x.extensions});this.$VideoUploadSession4=i.supportsChunking();this.$VideoUploadSession5=i.supportsFileAPI();this.$VideoUploadSession6=this.$VideoUploadSession7(x);this.$VideoUploadSession8=this.$VideoUploadSession9(x);this.$VideoUploadSessiona=this.$VideoUploadSessionb(x);}w.prototype.start=function(x){"use strict";this.$VideoUploadSessionc=null;this.$VideoUploadSessiond=false;this.$VideoUploadSessione=r.generate();this.$VideoUploadSessionf=new j(x);this.$VideoUploadSessiong=new l({source:this.$VideoUploadSession0,waterfall_id:this.$VideoUploadSessione,target_id:this.$VideoUploadSession1,delay:this.$VideoUploadSession2});this.__logEvent(l.EVENT_REQUESTED_UPLOADING);this.inform('upload-requested');var y=new m(this.$VideoUploadSessionf,this.$VideoUploadSessionh.bind(this));y.parse();};w.prototype.post=function(x){"use strict";var y=this.__createPostRequestContext(x);this.$VideoUploadSessiona.sendRequest(y);};w.prototype.__createPostRequestContext=function(x){"use strict";var y=new p();this.__setupPostRequestContext(y,x);return y;};w.prototype.__setupPostRequestContext=function(x,y){"use strict";x.setMetadata(y).setVideoID(this.$VideoUploadSessionc).setTargetID(this.$VideoUploadSession1).setSource(this.$VideoUploadSession0).setWaterfallID(this.$VideoUploadSessione).setSupportsChunking(this.$VideoUploadSession4);};w.prototype.cancel=function(){"use strict";if(!this.$VideoUploadSessiond)return;this.$VideoUploadSessioni();this.__logEvent(l.EVENT_CANCELED_UPLOADING);this.__logEvent(l.EVENT_CANCELED_FLOW);};w.prototype.abandon=function(){"use strict";if(!this.$VideoUploadSessiond)return;this.$VideoUploadSessioni();this.__logEvent(l.EVENT_ABANDONED_UPLOADING);this.__logEvent(l.EVENT_FAILED_FLOW);};w.prototype.isPostInProgress=function(){"use strict";return this.$VideoUploadSessiona.isInProgress();};w.prototype.isInProgress=function(){"use strict";return this.$VideoUploadSessiond;};w.prototype.getVideoID=function(){"use strict";return this.$VideoUploadSessionc;};w.prototype.getUploadTime=function(){"use strict";return this.$VideoUploadSessionj;};w.prototype.$VideoUploadSessionh=function(x){"use strict";if(!this.$VideoUploadSession3.validate(this.$VideoUploadSessionf,x)){this.__logEvent(l.EVENT_INVALIDATED_UPLOADING);this.inform('upload-failed');return;}this.__logEvent(l.EVENT_STARTED_FLOW);var y=new p().setFile(this.$VideoUploadSessionf).setTargetID(this.$VideoUploadSession1).setSource(this.$VideoUploadSession0).setWaterfallID(this.$VideoUploadSessione).setSupportsChunking(this.$VideoUploadSession4).setSupportsFileAPI(this.$VideoUploadSession5);this.$VideoUploadSessiond=true;this.$VideoUploadSession6.sendRequest(y);};w.prototype.$VideoUploadSession7=function(x){"use strict";var y=this.$VideoUploadSession4?x.chunk_start_uri:x.start_uri,z=this.__getVideoUploadStartRequestManager(y);z.subscribe('request-started',this.$VideoUploadSessionk.bind(this));z.subscribe('request-finished',this.$VideoUploadSessionl.bind(this));z.subscribe('request-failed',this.$VideoUploadSessionm.bind(this));return z;};w.prototype.$VideoUploadSession9=function(x){"use strict";var y=this.$VideoUploadSession4?x.chunk_receive_uri:x.receive_uri,z=this.__getVideoUploadReceiveRequestManager(y,x);z.subscribe('request-started',this.$VideoUploadSessionn.bind(this));z.subscribe('request-progressed',this.$VideoUploadSessiono.bind(this));z.subscribe('request-finished',this.$VideoUploadSessionp.bind(this));z.subscribe('request-failed',this.$VideoUploadSessionq.bind(this));z.subscribe('online',this.$VideoUploadSessionr.bind(this));z.subscribe('offline',this.$VideoUploadSessions.bind(this));return z;};w.prototype.$VideoUploadSessionb=function(x){"use strict";var y=this.$VideoUploadSession4?x.chunk_post_uri:x.post_uri,z=this.__getVideoUploadPostRequestManager(y);z.subscribe('request-finished',this.__handlePostRequestFinished.bind(this));z.subscribe('request-failed',this.$VideoUploadSessiont.bind(this));return z;};w.prototype.$VideoUploadSessionk=function(event,x){"use strict";this.__logEvent(l.EVENT_STARTED_UPLOADING);this.$VideoUploadSessionu=Date.now();this.inform('upload-started');};w.prototype.$VideoUploadSessionl=function(event,x){"use strict";this.$VideoUploadSessionc=x.video_id;var y=this.__createReceiveRequestContext(x);this.$VideoUploadSession8.sendRequest(y);};w.prototype.__createReceiveRequestContext=function(x){"use strict";var y=new p();this.__setupReceiveRequestContext(y,x);return y;};w.prototype.__setupReceiveRequestContext=function(x,y){"use strict";x.setFile(this.$VideoUploadSessionf).setVideoID(y.video_id).setStartOffset(y.start_offset).setEndOffset(y.end_offset).setTargetID(this.$VideoUploadSession1).setSource(this.$VideoUploadSession0).setWaterfallID(this.$VideoUploadSessione).setSupportsChunking(this.$VideoUploadSession4);};w.prototype.$VideoUploadSessionm=function(event,x){"use strict";this.__logEvent(l.EVENT_FAILED_UPLOADING,{error_code:x.error_code,error_description:x.error_description});this.__logEvent(l.EVENT_RESIGNED_FLOW);this.$VideoUploadSessiond=false;this.inform('upload-failed',x);};w.prototype.$VideoUploadSessionn=function(event,x){"use strict";if(!x.start_offset&&!x.transport_retries&&!x.server_retries)this.__logEvent(l.EVENT_STARTED_SENDING_BYTES,{total_bytes:this.$VideoUploadSessionf.getSize()});if(this.$VideoUploadSession4)this.__logEvent(l.EVENT_STARTED_SENDING_CHUNK_BYTES,{start_offset:x.start_offset,total_bytes:x.end_offset-x.start_offset,transport_retries:x.transport_retries,server_retries:x.server_retries,upload_speed:x.upload_speed});};w.prototype.$VideoUploadSessiono=function(event,x){"use strict";this.inform('upload-progressed',x);};w.prototype.$VideoUploadSessionp=function(event,x){"use strict";if(this.$VideoUploadSession4)this.__logEvent(l.EVENT_FINISHED_SENDING_CHUNK_BYTES,{start_offset:x.start_offset,sent_bytes:x.end_offset-x.start_offset,transport_retries:x.transport_retries,server_retries:x.server_retries,upload_speed:x.upload_speed});if(!this.$VideoUploadSession5||x.end_offset>=this.$VideoUploadSessionf.getSize()){this.__logEvent(l.EVENT_FINISHED_SENDING_BYTES,{sent_bytes:this.$VideoUploadSessionf.getSize()});this.$VideoUploadSessionj=Date.now()-this.$VideoUploadSessionu;this.inform('upload-finished',x);}};w.prototype.$VideoUploadSessionq=function(event,x){"use strict";this.__logEvent(l.EVENT_FAILED_UPLOADING,{error_code:x.error_code,error_description:x.error_description});this.__logEvent(l.EVENT_RESIGNED_FLOW);this.$VideoUploadSessiond=false;this.inform('upload-failed',x);};w.prototype.$VideoUploadSessionr=function(event,x){"use strict";this.inform('online',x);};w.prototype.$VideoUploadSessions=function(event,x){"use strict";this.inform('offline',x);};w.prototype.__handlePostRequestFinished=function(event,x){"use strict";if(!x.video_id)x.video_id=this.$VideoUploadSessionc;this.__logEvent(l.EVENT_FINISHED_UPLOADING,{elapsed_time:this.$VideoUploadSessionj});this.__logEvent(l.EVENT_FINISHED_FLOW);this.$VideoUploadSessiond=false;this.inform('post-finished',x);};w.prototype.$VideoUploadSessiont=function(event,x){"use strict";if(this.$VideoUploadSessiond){this.__logEvent(l.EVENT_FAILED_UPLOADING,{error_code:x.error_code,error_description:x.error_description});this.__logEvent(l.EVENT_RESIGNED_FLOW);}this.$VideoUploadSessiond=false;this.inform('post-failed',x);};w.prototype.$VideoUploadSessioni=function(){"use strict";this.$VideoUploadSession6.cancelRequest();this.$VideoUploadSession8.cancelRequest();if(this.$VideoUploadSessionc){new h('/ajax/video/actions/delete').setData({fbid:this.$VideoUploadSessionc,redirect:false}).send();this.$VideoUploadSessionc=null;}};w.prototype.__logEvent=function(event,x){"use strict";if(!this.$VideoUploadSessiong)return;x=x||{};if(this.$VideoUploadSessionf){x.file_size=this.$VideoUploadSessionf.getSize();x.file_extension=this.$VideoUploadSessionf.getExtension();}this.$VideoUploadSessiong.logEvent(event,x);};w.prototype.__getVideoUploadStartRequestManager=function(x){"use strict";return new q(x);};w.prototype.__getVideoUploadReceiveRequestManager=function(x,y){"use strict";return new o(x,y.max_transport_retries,y.max_server_retries,y.transport_retry_interval_base,y.server_retry_interval_base);};w.prototype.__getVideoUploadPostRequestManager=function(x){"use strict";return new n(x);};e.exports=w;},null);
__d("VideoUploader",["ArbiterMixin","VideoUploadSession","arrayContains","mixin"],function(a,b,c,d,e,f,g,h,i,j){var k=j(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o){"use strict";this.$VideoUploader0=o;this.$VideoUploader1=null;}n.prototype.upload=function(o){"use strict";if(this.$VideoUploader1)return;this.$VideoUploader1=this.__getVideoUploadSession(this.$VideoUploader0);this.$VideoUploader1.subscribe(this.__getEventsWhichShouldListenFromSession(),function(event,p){return this.$VideoUploader2(event,p);}.bind(this));this.$VideoUploader1.start(o);};n.prototype.__getVideoUploadSession=function(o){"use strict";return new h(o);};n.prototype.__getEventsWhichShouldListenFromSession=function(){"use strict";return ['upload-requested','upload-started','upload-progressed','upload-finished','upload-failed','post-finished','post-failed','online','offline'];};n.prototype.post=function(o){"use strict";if(!this.$VideoUploader1)return;this.$VideoUploader1.post(o);};n.prototype.cancel=function(){"use strict";if(!this.$VideoUploader1)return;this.$VideoUploader1.cancel();this.$VideoUploader1=null;};n.prototype.abandon=function(){"use strict";if(!this.$VideoUploader1)return;this.$VideoUploader1.abandon();this.$VideoUploader1=null;};n.prototype.reset=function(){"use strict";this.$VideoUploader1=null;};n.prototype.getUploadSession=function(){"use strict";return this.$VideoUploader1;};n.prototype.isPostInProgress=function(){"use strict";return !!this.$VideoUploader1&&this.$VideoUploader1.isPostInProgress();};n.prototype.isSessionInProgress=function(){"use strict";return !!this.$VideoUploader1&&this.$VideoUploader1.isInProgress();};n.prototype.__getSession=function(){"use strict";return this.$VideoUploader1;};n.prototype.__getEventsForWhichSessionShouldBeSetToNull=function(){"use strict";return ['upload-failed','post-finished'];};n.prototype.$VideoUploader2=function(event,o){"use strict";if(i(this.__getEventsForWhichSessionShouldBeSetToNull(),event))this.$VideoUploader1=null;this.inform(event,o);};e.exports=n;},null);