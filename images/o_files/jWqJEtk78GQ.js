/*!CK:3346875350!*//*1422247149,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["1Q+hG"]); }

__d("TimelineDOMID",[],function(a,b,c,d,e,f){e.exports={EARLIER_THIS_MONTH:"pagelet_timeline_earlier_this_month",EARLIER_THIS_MONTH_ALL:"pagelet_timeline_earlier_this_month_all",EARLIER_THIS_MONTH_EXPAND:"pagelet_timeline_earlier_this_month_expand",MEMORIES:"pagelet_timeline_memories",RECENT:"pagelet_timeline_recent",STICKY_HEADER:"timeline_sticky_header",TAB_CONTENT:"timeline_tab_content",TAB_CONTENT_EXTRA:"timeline_tab_content_extra",UNSEEN_STORIES_INDICATOR:"recent_unseen_stories_indicator",WAYBACK:"pagelet_timeline_wayback",PREFIX_MONTH:"pagelet_timeline_month_",PREFIX_MONTH_ALL:"pagelet_timeline_month_all_",PREFIX_MONTH_EXPAND:"pagelet_timeline_month_expand_",PREFIX_YEAR:"pagelet_timeline_year_",PREFIX_YEAR_EXPAND:"pagelet_timeline_year_expand_",SUFFIX_MORE_PAGER:"_more_pager"};},null);
__d("onViewportChanged",["EventListener","emptyFunction","getViewportDimensions","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j){var k=[],l=false,m=null,n,o;function p(){var aa=i.withoutScrollbars();return {top:0,bottom:aa.height,left:0,right:aa.width};}function q(aa,ba){var ca={transform:ba||h.thatReturnsArgument,callback:aa,needsUpdate:true};k.push(ca);x();s();return {remove:r.bind(null,ca),scheduleCheck:v.bind(null,ca)};}function r(aa){var ba=k.indexOf(aa);if(ba!==-1){k.splice(ba,1);if(k.length===0)t();}}function s(){if(!o){o=g.listen(window,'scroll',w);n=g.listen(window,'resize',u);}}function t(){if(o){o.remove();n.remove();o=n=null;}}function u(){m=null;w();}function v(aa){aa.needsUpdate=true;x();}function w(){k.map(function(aa){return aa.needsUpdate=true;});x();}function x(){if(!l){l=true;j(function(){l=false;z();});}}function y(aa){if(aa.needsUpdate){aa.needsUpdate=false;return true;}return false;}function z(){if(!m)m=p();var aa=k.filter(y),ba=aa.map(function(ca){return ca.transform.call(null,m);});aa.forEach(function(ca,da){return ca.callback.call(null,ba[da]);});}e.exports=q;},null);
__d("onRectIsWithinViewport",["onViewportChanged"],function(a,b,c,d,e,f,g){function h(j,k){return !(j.bottom<k.top||j.top>k.bottom||j.right<k.left||j.left>k.right);}function i(j,k){var l;function m(o){var p=j();return !!p&&h(p,o);}function n(o){if(l!==o){l=o;k(o);}}return g(n,m);}e.exports=i;},null);
__d("OnVisible.react",["React","getElementRect","onRectIsWithinViewport","onlyChild"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:"OnVisible",propTypes:{onVisible:g.PropTypes.func,onHidden:g.PropTypes.func,buffer:g.PropTypes.number},componentDidMount:function(){this._createListener();},componentDidUpdate:function(){this._createListener();},componentWillUnmount:function(){this._removeListener();},reset:function(){this._removeListener();this._createListener();},check:function(){if(this._listener)this._listener.scheduleCheck();},_measureElementRect:function(){if(!this.isMounted())return null;var l=this.props.buffer||0,m=h(this.getDOMNode());m.left-=l;m.right+=l;m.top-=l;m.bottom+=l;return m;},_createListener:function(){var l=this.getDOMNode();if(this._listener&&l!==this._element)this._removeListener();if(!this._listener){this._element=l;this._listener=i(this._measureElementRect,function(m){var n=m?this.props.onVisible:this.props.onHidden;n&&n();}.bind(this));}},_removeListener:function(){if(this._listener){this._listener.remove();this._listener=null;}},render:function(){return j(this.props.children);}});e.exports=k;},null);
__d("XEventImpressionLoggerAsyncController",["XController"],function(a,b,c,d,e,f){e.exports=b("XController").create("\/events\/{eventid}\/ajax\/impression\/",{eventid:{type:"Int",required:true},acontext:{type:"StringToStringMap",required:true}});},null);
__d("EventImpressionLogger.react",["Arbiter","React","OnVisible.react","DOMContainer.react","AsyncRequest","XEventImpressionLoggerAsyncController"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=h.createClass({displayName:"EventImpressionLogger",propTypes:{child:h.PropTypes.object.isRequired,event_id:h.PropTypes.number.isRequired,action_context:h.PropTypes.object.isRequired,start_signal:h.PropTypes.string,stop_signal:h.PropTypes.string,check_signal:h.PropTypes.string},componentDidMount:function(){this._listening=!this.props.start_signal;if(this.props.start_signal)g.subscribe(this.props.start_signal,function(n,o){this._signalData=o;this._listening=true;if(this._signalData){this._logImpression();}else if(!this.logged){this.refs.onvisible.reset();this.refs.onvisible.check();}}.bind(this));if(this.props.stop_signal)g.subscribe(this.props.stop_signal,function(){this._signalData=null;this._listening=false;}.bind(this));if(this.props.check_signal)g.subscribe(this.props.check_signal,function(n,o){this._signalData=o;if(this._signalData){this._logImpression();}else if(!this.logged){this.refs.onvisible.reset();this.refs.onvisible.check();}}.bind(this));},_logImpression:function(){if(!this._listening)return;if(this.logged)return;if(!document.documentElement.contains(this.props.child))return;if(this._signalData&&this._signalData.rect){var n=this.props.child.getBoundingClientRect(),o=this._signalData.rect,p=0;if(this._signalData.scrollTop)p=this._signalData.scrollTop;if(o.left&&o.left>n.left)return;if(o.right&&o.right<n.right)return;if(o.top&&o.top>n.top-p)return;if(o.bottom&&o.bottom<n.bottom-p)return;}this.logged=true;var q=l.getURIBuilder().setInt('eventid',this.props.event_id).setStringToStringMap('acontext',this.props.action_context).getURI();new k(q).send();},render:function(){return (h.createElement(i,{onVisible:this._logImpression,ref:"onvisible"},h.createElement(j,null,this.props.child)));}});e.exports=m;},null);